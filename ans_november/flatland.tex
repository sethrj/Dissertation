\documentclass{anstrans}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{Diffusion Boundary Conditions in Flatland Geometry}
\author{Seth R.~Johnson \and Edward W.~Larsen}

\institute{Department of Nuclear Engineering \& Radiological Sciences, University of Michigan, Ann Arbor, MI, 48109}
\email{sethrj@umich.edu \and edlarsen@umich.edu}
\usepackage{amssymb}
\usepackage{microtype}
\usepackage{graphicx}
\usepackage{booktabs} % \toprule, \midrule, \bottomrule
\input{../SRJinclude.tex}

% graphics paths
\graphicspath{{/Users/seth/_research/figures/}}
\makeatletter
\def\input@path{{/Users/seth/_research/figures/}}
\makeatother

\renewcommand{\bottomfraction}{0.99}
\renewcommand{\topfraction}{0.99}
\setlength{\parskip}{0pt}

\date{2011/05/30}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
``Flatland'' geometry is a fictional space in which particles are constrained to
travel in a 2D plane \cite{Asa2008}. Because the flatland phase space is
$(x,y,\theta)$ with \emph{one} angular variable $\theta$, rather than the
standard 2D $(x,y,\mu,\theta)$ with \emph{two} angular variables $\mu$ and
$\theta$, flatland is a computationally simpler testing ground that retains the
complexity of multidimensional geometry. For this reason, flatland has recently
been used in the development and testing of multi-D transport methods
\cite{Lar2009c,Joh2011,Tra2011}.

Previous work has shown that the physical (3D) diffusion coefficient
$\frac{1}{3\sigma}$ differs from the flatland diffusion coefficient
$\frac{1}{2\sigma}$, but accurate boundary conditions for the flatland
diffusion equations have not been derived. Clearly, an accurate diffusion
boundary condition is imperative for benchmarking new transport methods against
diffusion solutions. Thus, in the following we \textsl{(i)} derive ``Marshak''
and ``variational'' boundary conditions for the flatland diffusion equation,
and \textsl{(ii)} demonstrate the accuracy of these results via numerical
simulations. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Analysis}
The steady-state, monoenergetic transport equation is
\begin{equation}\label{eq:generalTransport}
  \vec{\Omega}\vd \grad \psi + \sigma \psi
  = \frac{c \sigma}{\omega_0} \int_{\Omega} \psi \ud\Omega + \frac{q}{\omega_0}
  \quad \vec{x}\in V,\ \vec{\Omega}\in \Omega \,,
\end{equation}
where the direction vector $\vec{\Omega}$, the unit ``sphere'' $\Omega$, and
the constant $\omega_0$ depend on whether the geometry
is flatland or 2D. We consider a specified incident boundary condition:
\begin{equation} \label{eq:ssBndy}
  \psi(\vec{x}, \vec{\Omega}) = \psi^b(\vec{x}, \vec{\Omega})\,,
  \quad \vec{x}\in \partial V,\ \vec{\Omega} \vd \vec{n} < 0\,.
\end{equation}

In 2D geometry, $\vec{\Omega}=\sqrt{1-\mu^2} \cos \theta \vec{i} +
\sqrt{1-\mu^2} \sin \theta \vec{j}$; and in flatland, $\vec{\Omega}=\cos \theta
\vec{i} + \sin \theta \vec{j}$. The domain of angular integration $\Omega$ in
2D is $-1\le\mu\le1$, $0 \le \theta < 2\pi$; in flatland, it is $0 \le \theta
< 2\pi$. These lead to the different angular moments
\begin{equation}\label{eq:omegaIdentities}
  \omega_m = \int_{\Omega} \abs{\vec{\Omega}\vd \vec{i}}^m \ud\Omega\,.
\end{equation}
In 2D, $\omega_0=4\pi$, $\omega_1=2\pi$, and $\omega_2=\frac{4\pi}{3}$.
However, in flatland, $\omega_0=2\pi$, $\omega_1=4$, and $\omega_2=\pi$. The
differences between these values lead to different diffusion 
coefficients and different boundary conditions.

Under the assumption that $\psi$ is linear in angle, the first angular moment
of the transport equation can be reduced to Fick's law, expressed using the
identities of Eq.~\eqref{eq:omegaIdentities}:
\begin{equation} \label{eq:fickGeneral}
  \vec{J}(\vec{x})
  = - \frac{\omega_2}{\omega_0} \frac{1}{\sigma(\vec{x})} \grad \phi(\vec{x})
  \equiv -D(\vec{x}) \grad \phi(\vec{x})\,.
\end{equation}
In 2D and 3D, $\omega_2/\omega_0 = (4\pi / 3) / (4\pi) = 1/3$; however, in
flatland, $\omega_2/\omega_0 = \pi / (2\pi) = 1/2$. Thus, $D=\frac{1}{3\sigma}$ in
2D but $D=\frac{1}{2\sigma}$ in flatland.

Fick's law and the linear-in-angle approximation give the following diffusion
approximation to the angular flux:
\begin{equation} \label{eq:diffusionIntensity}
  \psi(\vec{x}, \vec{\Omega})
  = \frac{1}{\omega_0} \left( \phi(\vec{x})
  - \frac{1}{\sigma(\vec{x})}
  \vec{\Omega} \vd \grad \phi(\vec{x}) \right) \,.
\end{equation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Marshak Boundary Condition}
The Marshak boundary condition preserves the incident
current on the boundary. It is derived by substituting the approximate diffusion
angular flux from Eq.~\eqref{eq:diffusionIntensity} into the boundary condition,
Eq.~\eqref{eq:ssBndy}, multiplying by $\abs{\vec{\Omega}\vd \vec{n}}$, and integrating over
incident directions:
\begin{align*}
\int_{\vec{\Omega}\vd \vec{n} < 0 } \abs{\vec{\Omega}\vd \vec{n}}
\psi^b \ud\Omega
 &= 
\int_{\vec{\Omega}\vd \vec{n} < 0 } \abs{\vec{\Omega}\vd \vec{n}} 
 \frac{1}{\omega_0} \left( \phi - \frac{1}{\sigma}
  \vec{\Omega} \vd \grad \phi \right)
  \ud\Omega \,.
\end{align*}
Using the definitions in Eq.~\eqref{eq:omegaIdentities}, we
find the following general-geometry expression for the Marshak boundary
condition:
\begin{equation} \label{eq:marshak}
\frac{2\omega_0}{\omega_1}
\int_{\vec{\Omega}\vd \vec{n} < 0 } \abs{\vec{\Omega}\vd \vec{n}}
\psi^b \ud\Omega
=
\phi + \frac{\omega_2}{\omega_1}\frac{1}{\sigma} \vec{n} \vd \grad \phi \,.
\end{equation}
In 2D, this evaluates to the standard Marshak boundary condition with
extrapolation distance $\frac{\omega_2}{\omega_1} = \frac23$, but in flatland
it gives
\begin{equation*}
\pi J^{-} = \phi + \frac{\pi}{4}\frac{1}{\sigma} \vec{n} \vd \grad \phi
= \phi + \frac{\pi}{2} D \vec{n} \vd \grad \phi\,.
\end{equation*}
Thus, the flatland extrapolation distance of $\frac{\pi}{4} \approx 0.7854$
is about 18\% longer than in 2D.
The physical reason for this is that in 2D, a significant fraction of
particles travel at a steep angle to the $x,y$-plane, yielding a
shorter extrapolation distance, i.e.~a steeper slope for $\phi$ on the boundary.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Variational Boundary Condition}
It is known that the Marshak boundary condition is heuristic and that
a more accurate boundary condition for diffusion can be derived from an
asymptotic matched boundary layer analysis \cite{Mal1991}. However, a simpler
method of deriving a more accurate (than Marshak) boundary condition is to use
a variational analysis \cite{Mal1991}. Here, we adapt the variational analysis
to flatland geometry.

We consider a steady-state, homogeneous, purely scattering transport problem in
a semi-infinite plane, $-\infty < x < \infty$, $0 < y < \infty$,
\begin{subequations} \label{eqs:flatTransport}
\begin{equation}\label{eq:flatTransportVol}
  \vec{\Omega}\vd \grad \psi + \sigma \psi
  = \frac{\sigma}{2\pi} \int_{0}^{2\pi} \psi \ud\theta\,, \quad 0 \le \theta <
  2\pi\,.
\end{equation}
It has a uniform incident boundary condition,
\begin{equation}\label{eq:flatTransportBndy}
  \psi(x, 0, \theta) = \psi^b(\theta)\,,
  \quad 0 \le \theta < \pi \,.
\end{equation}
\end{subequations}
Because there is no variation in the boundary condition or $\sigma$ 
in $x$, $\tpder{\psi}{x}=0$, and Eq.~\eqref{eq:flatTransportVol} reduces to
the one-dimensional flatland transport equation 
\begin{equation}\label{eq:flatMarshak}
  \sin \theta \pder{}{y}\psi(y,\theta) + \sigma \psi(y,\theta)
  = \frac{\sigma}{2\pi} \int_{0}^{2\pi} \psi(y,\theta') \ud \theta'\,,
\end{equation}
which is \emph{not} the 1D planar geometry transport equation.
We define the $y$ components of the angular moments of $\psi$ as
\begin{equation} \label{eq:flatPhi}
  \phi_m(y) = \int_{0}^{2\pi} (\vec{\Omega}\vd\vec{j})^m \psi(y,\theta) \ud\theta
  = \int_{0}^{2\pi} (\sin\theta)^m \psi(y,\theta) \ud\theta \,.
\end{equation}
As $y\to\infty$, the angular flux $\psi$ will approach a constant
$\varphi/2\pi$,
which gives $\phi_0(\infty)=\varphi$. Concordantly, $\phi_1(\infty)=0$.

Operating on Eq.~\eqref{eq:flatMarshak} by $\int_{0}^{2\pi} (\sin\theta)^m
(\cdot) \ud\theta$ gives the $m$th angular moment in the $y$ direction:
\begin{align}
 % \nonumber
 % \pder{}{y} \int_{0}^{2\pi} (\sin\theta)^{m+1} \psi \ud\theta
 % + \sigma \int_{0}^{2\pi} (\sin\theta)^{m} \psi \ud\theta
 % &= \frac{\sigma}{2\pi} \int_{0}^{2\pi} \psi \ud \theta'
 % \int_{0}^{2\pi} (\sin\theta)^{m} \ud\theta
 % \\
  \label{eq:flatMoments}
  \pder{\phi_{m+1}}{y}
  + \sigma \phi_{m}
  &= \frac{\sigma}{2\pi} \phi_{0}
  \int_{0}^{2\pi} (\sin\theta)^{m} \ud\theta\,.
\end{align}
For $m=0$, the conservation equation, Eq.~\eqref{eq:flatMoments} evaluates to
\begin{equation*}
  \pder{\phi_{1}}{y}
  + \sigma \phi_{0}
  = \frac{\sigma}{2\pi} \phi_{0} (2\pi)
  \lra
  \pder{\phi_{1}}{y} = 0\,.
\end{equation*}
Thus $\phi_1(y)$ is a constant, and because $\phi_1(\infty)=0$,
that constant is zero.

Evaluating Eq.~\eqref{eq:flatMoments} for $m=1$ and using
$\phi_{1}=0$, we find
\begin{equation*}
  \pder{\phi_{2}}{y}
  + \sigma \phi_{1}
  = \frac{\sigma}{2\pi} \phi_{0} (0)
  \lra
  \pder{\phi_{2}}{y} = 0\,.
\end{equation*}
Thus $\phi_{2}$ is also a constant. As $y\to\infty$, $\psi\to\varphi/2\pi$, so
\begin{equation*}
  \phi_{2} = \int_{0}^{2\pi} (\sin\theta)^2 \frac{\varphi}{2\pi} \ud\theta
  = \frac{1}{2} \varphi\,.
\end{equation*}
% in 1D, this would be $\int_{-1}^{1}\mu^2\frac{\varphi}{2} \ud \mu =
% \frac{1}{3} \varphi$.

Since $\phi_1=0$, we can add $\alpha \phi_1$ to the previous equation for any
$\alpha$:
\begin{align*}
 %\alpha\phi_1 + \phi_{2} &= \frac{\varphi}{2} \\
 \int_{0}^{2\pi} (\alpha \sin\theta + \sin^2\theta)
 \psi(y,\theta) \ud\theta
 &= \frac{\varphi}{2}\,.
\end{align*}
At the boundary $y=0$, $\psi=\psi^b$ for incident angles $0 \le \theta < \pi$.
The
variational analysis makes the reasonable approximation that, to leading order,
the exiting particles are isotropically distributed,
$\psi(0,\theta)=\psi^\text{out}$.
The previous equation then yields
\begin{equation*}
 \int_{0}^{\pi} (\alpha \sin\theta + \sin^2\theta)
 \psi^b(\theta) \ud\theta
 + \int_{\pi}^{2\pi} (\alpha \sin\theta + \sin^2\theta)\ud\theta \psi^\text{out}
 = \frac{\varphi}{2}\,.
\end{equation*}
The value $\alpha=\pi/4$ eliminates the integral over outgoing directions and
gives a relation between moments of the incident angular flux and the
magnitude of the angular flux as $y\to\infty$:
\begin{equation}\label{eq:varBoundary}
  \int_{0}^{\pi} \left( \frac{\pi}{4} \sin\theta + \sin^2\theta \right)
 \psi^b(\theta) \ud\theta
 = \frac{\varphi}{2}\,.
\end{equation}

We wish our boundary condition to preserve the value of $\varphi$ when the
diffusion method is used, so we substitute the diffusion approximation,
Eq.~\eqref{eq:diffusionIntensity}:
\begin{align*}
 \varphi &= 2\int_{0}^{\pi} \left( \frac{\pi}{4} \sin\theta + \sin^2\theta \right)
 \psi^b(\theta) \ud\theta
 \\
 &= 
  2\int_{0}^{\pi} \left( \frac{\pi}{4} \sin\theta + \sin^2\theta \right)
 \left( \frac{1}{2\pi} \phi -
  \frac{1}{\sigma} \sin\theta \pder{\phi_0}{y}\right)\ud\theta
\\
 &= 
  \phi
- \left( \frac{\pi}{8} + \frac{4}{3\pi} \right) \frac{1}{\sigma} \pder{\phi_0}{y}
\,.
\end{align*}
In this problem, the boundary surface outer normal is $\vec{n}=-\vec{j}$. 
Replacing $\sin \theta$ with $-\vec{\Omega}\vd\vec{n}$, we obtain the following
flatland variational boundary condition:
\begin{multline} \label{eq:flatVarBc}
\int_{\vec{\Omega}\vd\vec{n} < 0} \left[ \frac{\pi}{2}
\abs{\vec{\Omega}\vd\vec{n}} + 2 (\vec{\Omega}\vd\vec{n})^2 \right]
\psi^b(\vec{x}, \vec{\Omega}) \ud\Omega
\\
= 
  \phi(\vec{x})
  - \left( \frac{\pi}{8} + \frac{4}{3\pi} \right) \frac{1}{\sigma}
  \vec{n}\vd\grad \phi(\vec{x})\,.
\end{multline}
Compared to the flatland Marshak boundary condition,
Eq.~\eqref{eq:flatMarshak}, the variational boundary condition not only yields a
different extrapolation distance $\frac{\pi}{8} + \frac{4}{3\pi} \approx
0.8171$ but also uses a different moment of the incident boundary flux.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Numerical Results}
As a test problem, we consider a homogeneous flatland problem with a
total cross section $\sigma=1$ and scattering ratio $c=0.99$. The spatial 
domain is the rectangle $0 \le x \le 2$, \linebreak $0 \le y \le 10$, with
reflecting boundaries on the left,
right, and top sides. The bottom side has a specified unit-current incident
flux; we consider three different angular
distributions.


The first distribution is isotropic, $\psi^b(\theta) = \frac{1}{2}$. The second
is a normally incident flux, with all particles entering
perpendicular to the surface, $\psi^b(\theta) = \delta(\theta -
\frac{\pi}{2})$. The third incident distribution is at a grazing angle, with 
$\psi^b(\theta) = 10 \delta(\theta - \sin^{-1}.1)$.

Figure~\ref{fig:isotropic} shows a line-out of the scalar flux $\phi_0$ along
$x=1$ for an isotropic incident source. Because the left-hand sides of
Eqs.~\eqref{eq:flatMarshak} and~\eqref{eq:flatVarBc} are the same, the
differences in the solution are only due to the slightly different
extrapolation distance.

For the highly anisotropic normal and grazing cases,
Figs.~\ref{fig:delta} and~\ref{fig:grazing}, the Marshak boundary fails to
limit to the transport solution outside of the boundary layer. However, 
the variational boundary condition yields much more accurate
approximates the scalar flux in the interior of the system.

\begin{figure}[htb!]
  \centering
  \hspace{-.5in}
  \input{flatlandbc-channel/isotropic-phi/plot}
  \hspace{-.5in}
  \caption{Scalar flux with an isotropic boundary condition.}
  \label{fig:isotropic}
\end{figure}

\begin{figure}[htb!]
  \centering
  \hspace{-.5in}
  \input{flatlandbc-channel/delta-phi/plot}
  \hspace{-.5in}
  \caption{Scalar flux with a normally incident boundary condition.}
  \label{fig:delta}
\end{figure}

\begin{figure}[htb!]
  \centering
  \hspace{-.5in}
  \input{flatlandbc-channel/grazing-phi/plot}
  \hspace{-.5in}
  \caption{Scalar flux with a grazing boundary condition.}
  \label{fig:grazing}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusions}
We have derived and tested Marshak and variational boundary
conditions for the diffusion approximation to the transport equation in
flatland geometry. 

The Marshak boundary condition, which uses $\pi \int_{\vec{\Omega}\vd \vec{n} <
0 } \abs{\vec{\Omega}\vd \vec{n}} \psi^b \ud\Omega$, gives an extrapolation
distance of about $0.7854$.  The variational boundary condition given in
Eq.~\eqref{eq:flatVarBc} uses $\int_{\vec{\Omega}\vd\vec{n} < 0} \left[
\frac{\pi}{2} \abs{\vec{\Omega}\vd\vec{n}} + 2 (\vec{\Omega}\vd\vec{n})^2
\right] \psi^b(\vec{x}, \vec{\Omega}) \ud\Omega$ with the extrapolation
distance of about $0.8171$. Numerical simulations show that the variational
boundary condition is significantly more accurate than the Marshak condition,
especially for anisotropic incident boundary fluxes $\psi^b$. Overall, the
flatland Marshak and variational diffusion boundary conditions have accuracies
comparable to their 3D counterparts. 

These results have application in the testing of numerical methods for multi-D
transport problems. The flatland implementation of these methods is easier and
less costly than in standard 2D or 3D geometries, and the results seen in
flatland are strongly correlated to results in 2D and 3D.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Acknowledgments}
This material is based upon work supported under a Department of Energy Nuclear
Energy University Programs Graduate Fellowship.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{ans}
\bibliography{../SRJall}
\end{document}

