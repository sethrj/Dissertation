% !TEX root = _individual/adDerivation.tex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Anisotropic diffusion theory}\label{chap:adDerivation}

The previous work in anisotropic diffusion has only considered a steady-state
problem in an infinite medium \cite{Lar2009c,Mor2007}. The new understanding of
the AD method presented in this chapter provides a theoretical basis for
using the AD method in time-dependent and nonlinear contexts, and it also
addresses the heretofore unsolved problem of boundary conditions for the AD
method.

%For the anisotropic diffusion method, the most straightforward derivation
%involves approximating not $I$ but a quantity which we shall term the
%anisotropic intensity $\Psi$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Anisotropic transport equation}
We begin by considering the gray radiation transport equation inside a time step
$0 \le t \le \Delta_t$,
with opacities frozen at some value $\sigma^\ast$ (which could be
$\sigma^n$ for a semi-implicit formulation, or $\sigma^{n+1,(k)}$ if
Picard iteration \cite{Kel1995} is being used to converge the nonlinearities).
The transport equation is:
\begin{subequations} \label{eqs:fullTransport}
\begin{multline} \label{eq:fullTransportVol}
  \frac{1}{c} \pder{I}{t}(\vec{x}, \vec{\Omega}, t)
    + \vec{\Omega}\vd \grad I(\vec{x}, \vec{\Omega}, t)
    + \sigma^\ast(\vec{x}) I (\vec{x}, \vec{\Omega}, t)
    \\ = \frac{1}{4\pi} \sigma^\ast(\vec{x}) ac [T(\vec{x}, t)]^4
    + \frac{1}{4\pi} q_{r}(\vec{x}, t)
    \equiv \frac{1}{4\pi} Q(\vec{x}, t) \,,
\\
x \in V,\  0 \le t \le \Delta_t, \ \vec{\Omega} \in 4\pi\,.
\end{multline}
It has incident radiation on some subset of the boundary, i.e.\ the Dirchlet
boundary condition
\begin{equation} \label{eq:fullTransportBndy}
  I(\vec{x}, \vec{\Omega}, t) = I^b(\vec{x}, \vec{\Omega}, t) \,,
 \quad \vec{x} \in \partial V_b, \ \vec{\Omega} \vd \vec{n} < 0,
 \ 0 \le t \le \Delta_t\,,
\end{equation}
and a reflecting boundary condition on the rest of the boundary,
\begin{equation} \label{eq:fullTransportRefl}
  I(\vec{x}, \vec{\Omega}, t)
  = I(\vec{x}, \vec{\Omega}_r, t)
  \,,
 \quad \vec{x} \in \partial V_r, \ \vec{\Omega} \vd \vec{n} < 0,
 \ 0 \le t \le \Delta_t\,.
\end{equation}
It also has the initial condition
\begin{equation} \label{eq:fullTransportInit}
 I(\vec{x}, \vec{\Omega}, 0) = I^i(\vec{x}, \vec{\Omega}) \,,
 \quad \vec{x} \in V, \ \vec{\Omega} \in 4\pi\,,
\end{equation}
which is usually the solution from the previous time step.
\end{subequations}
The reflected angle on a boundary surface with outward normal $\vec{n}$ is just
\begin{equation} \label{eq:reflection}
  \vec{\Omega}_r = \vec{\Omega} - 2(\vec{\Omega} \vd \vec{n}) \vec{n}
\end{equation}
for incident angles, $\vec{\Omega} \vd \vec{n}<0$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The particle (or radiation energy) conservation equation is the zeroth moment of
the transport equation.
\begin{subequations} \label{eqs:loEquations}
Operating on Eq.~\eqref{eq:fullTransportVol} by $\int_{4\pi} (\cdot) \ud
\Omega$ gives
\begin{equation} \label{eq:loVol}
\frac{1}{c} \pder{\phi}{t} (\vec{x}, t)
  + \grad \vd\vec{F}(\vec{x}, t)
  + \sigma^\ast(\vec{x}) \phi(\vec{x}, t)
  = \sigma^\ast(\vec{x}) ac [T(\vec{x}, t)]^4 + q_{r}(\vec{x}, t)
  = Q(\vec{x}, t)\,,
\end{equation}
for $\vec{x} \in V$ and $0 \le t \le \Delta_t$.
Doing the same to the initial condition, Eq.~\eqref{eq:fullTransportInit}, gives 
\begin{equation} \label{eq:loInit}
\phi(\vec{x}, 0) = \int_{4\pi}  I^i(\vec{x},
\vec{\Omega}) \ud\Omega = \phi^i(\vec{x})\,, \vec{x} \in V  \,.
\end{equation}
\end{subequations}
As discussed in \S\ref{sec:trtEquations}, the first two moments of the
intensity are the scalar intensity $\phi=\int_{4\pi} I \ud\Omega$ and the
radiation flux $\vec{F} = \int_{4\pi} \vec{\Omega} I \ud\Omega$.
Equations~\eqref{eqs:loEquations} form the first piece of the ``low-order'' set
of equations for the AD method. As in many approximate methods, we will be
seeking some closure for this equation with an approximation to the radiation
flux $\vec{F}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Adding $\vec{\Omega}\vd \grad \phi$ to both sides of Eq.~\eqref{eq:loVol},
multiplying by $\frac{1}{4\pi}$, and subtracting from
Eq.~\eqref{eq:fullTransportVol}, we cancel the isotropic radiation source $Q$
and get
\begin{equation*}
  \frac{1}{c} \pder{}{t}\left[ I
  - \frac{1}{4\pi} \phi \right]
    + \vec{\Omega}\vd \grad \left[ I
  - \frac{1}{4\pi} \phi \right]
   + \sigma^\ast \left[ I
  - \frac{1}{4\pi} \phi \right]
  = 0 + \frac{1}{4\pi} \grad \vd\vec{F} -
  \frac{1}{4\pi} \vec{\Omega}\vd \grad \phi\,.
\end{equation*}
Defining
\begin{equation} \label{eq:capPsi}
  \Psi(\vec{x}, \vec{\Omega}, t) \equiv I(\vec{x}, \vec{\Omega}, t) -
  \frac{1}{4\pi} \phi(\vec{x}, t)\,,
\end{equation}
we have a transport equation for $\Psi$:
\begin{equation} \label{eq:capPsiVol}
  \frac{1}{c} \pder{}{t}\Psi(\vec{x}, \vec{\Omega}, t)
    + \vec{\Omega}\vd \grad \Psi(\vec{x}, \vec{\Omega}, t)
    + \sigma^\ast(\vec{x}) \Psi(\vec{x}, \vec{\Omega}, t)
  = \frac{1}{4\pi} \grad \vd\vec{F}(\vec{x}, t) -
  \frac{1}{4\pi} \vec{\Omega}\vd \grad \phi(\vec{x}, t)\,,
\end{equation}
which has the same domain as the original transport equation: $\vec{x} \in
\partial V_b$, $\vec{\Omega} \vd \vec{n} < 0$, $0 \le t \le \Delta_t$. The
transport equation for $I$ satisfies Eq.~\eqref{eq:capPsiVol} exactly.
No approximations have been made, but now instead of an isotropic source term
on the right hand side, we have an anisotropic source term that depends on the
unknowns $\phi$ and $\vec{F}$.

The quantity $\Psi$ can be thought of as a spherical harmonic expansion
of $I$ with the first (isotropic) term removed, then reconstituted: it is a full
representation of the anisotropic components of $\Psi$. By definition, $\Psi$
satisfies two important identities.
\begin{subequations} \label{eqs:capPsiIdentities}
Its zeroth moment is identically zero:
\begin{equation} \label{eq:capPsiZeroth}
  \int_{4\pi} \Psi(\vec{x}, \vec{\Omega}, t) \ud\Omega
  = \int_{4\pi} I \ud\Omega
  - \frac{1}{4\pi}\int_{4\pi} \ud\Omega \,\phi
  = \phi - \phi
  = 0\,,
\end{equation}
and its first moment is the radiation flux:
\begin{equation} \label{eq:capPsiFirst}
  \int_{4\pi} \vec{\Omega} \Psi(\vec{x}, \vec{\Omega}, t) \ud\Omega
  = \int_{4\pi} \vec{\Omega} I \ud\Omega
  - \frac{1}{4\pi} \int_{4\pi} \vec{\Omega} \ud\Omega \,\phi
  = \vec{F} - \vec{0}
  = \vec{F}(\vec{x}, t)\,.
\end{equation}
\end{subequations}

Now we formulate boundary conditions for $\Psi$ from the transport equation.
For specified incident radiation boundaries, we subtract $\phi/4\pi$ from 
Eq.~\eqref{eq:fullTransportBndy}:
\begin{align}\nonumber
  I(\vec{x}, \vec{\Omega}, t) - \frac{1}{4\pi} \phi(\vec{x}, t)
  &= I^b(\vec{x}, \vec{\Omega}, t) - \frac{1}{4\pi} \phi(\vec{x}, t)
  \\ 
  \intertext{Substituting Eq.~\eqref{eq:capPsi} into the left hand side gives a
  boundary condition for $\Psi$:
  } \label{eq:capPsiBndy}
 \Psi(\vec{x}, \vec{\Omega}, t) 
  &=I^b(\vec{x}, \vec{\Omega}, t) - \frac{1}{4\pi} \phi(\vec{x}, t)\,,
\end{align}

We do the same with a reflecting boundary by subtracting $\phi/4\pi$ from 
Eq.~\eqref{eq:fullTransportBndy}:
\begin{align}\nonumber
  I(\vec{x}, \vec{\Omega}, t) - \frac{1}{4\pi} \phi(\vec{x}, t)
  &= I(\vec{x}, \vec{\Omega} - 2(\vec{\Omega} \vd \vec{n}) \vec{n}, t)
   - \frac{1}{4\pi} \phi(\vec{x}, t)\,.
  \\ \label{eq:capPsiRefl}
 \Psi(\vec{x}, \vec{\Omega}, t) 
  &= \Psi(\vec{x}, \vec{\Omega}_r, t)
\end{align}
for $\vec{x} \in \partial V_r$, $\vec{\Omega} \vd \vec{n} < 0$,
$0 \le t \le \Delta_t$.

Finally, to get an initial condition for $\Psi$, we
multiply the low-order initial condition \eqref{eq:loInit} by $1/4\pi$ and
subtract it from the initial condition for the intensity,
Eq.~\eqref{eq:fullTransportInit}:
\begin{align}\nonumber
  I(\vec{x}, \vec{\Omega}, 0) - \frac{1}{4\pi}\phi(\vec{x}, 0)
 &= I^i(\vec{x}, \vec{\Omega} - \frac1{4\pi} \phi^i(\vec{x})
 \\ \label{eq:capPsiInit}
 \Psi(\vec{x}, \vec{\Omega}, 0)
 &\equiv \Psi^i(\vec{x}, \vec{\Omega}, t)
 \,,
\end{align}
for $\vec{x} \in V$, $\vec{\Omega} \in 4\pi$.

Equations \eqref{eq:capPsiVol},~\eqref{eq:capPsiBndy},%
~\eqref{eq:capPsiRefl}, and~\eqref{eq:capPsiInit} comprise the transport
equation for $\Psi$; they are satisfied by the exact transport solution. No
approximations have been made, but we have effectively replaced an isotropic
source on the right-hand side with an anisotropic source that depends on
angular moments of the intensity.

A later discussion section, \S\ref{sec:adDiscDiff}, describes how Fick's law can
be derived from the equations for $\Psi$
by using the linearly anisotropic approximation \mbox{$\Psi\approx \frac{3}{4\pi}
\vec{\Omega}\vd\vec{F}$}, but we shall instead use the transport
equations for $\Psi$ to
derive a new approximation that yields an expression distinct from but 
analogous to Fick's law.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Anisotropic diffusion derivation}
The anisotropic diffusion approximation is derived by manipulating the
transport equation for $\Psi$ and assuming that the gradients and anisotropy
of the solution are small. Some care must be taken in deriving
a suitable boundary condition, because we desire a simple expression for
$\vec{F}$ that only depends on \textsl{(i)} the low-order unknown $\phi$ and
\textsl{(ii)} something analogous to the diffusion coefficient that depends only
on problem data such as $\sigma$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Modification for boundary condition treatment}
In order to formulate transport-matched boundary conditions, we separate $\Psi$
into an internal solution $\tilde\Psi$ and a boundary layer solution
$\Psi_\mathrm{bl}$:
\begin{equation} \label{eq:boundaryLayerPsi}
  \Psi(\vec{x}, \vec{\Omega}, t)
  = \tilde\Psi(\vec{x}, \vec{\Omega}, t)
  + \Psi_\mathrm{bl}(\vec{x}, \vec{\Omega}, t)\,.
\end{equation}

\begin{subequations} \label{eqs:tCapPsi}
  The internal transport equation is just like Eq.~\eqref{eq:capPsiBndy}:
\begin{multline} \label{eq:tCapPsiVol}
  \frac{1}{c} \pder{}{t}\tilde\Psi(\vec{x}, \vec{\Omega}, t)
    + \vec{\Omega}\vd \grad \tilde\Psi(\vec{x}, \vec{\Omega}, t)
    + \sigma^\ast(\vec{x}) \tilde\Psi(\vec{x}, \vec{\Omega}, t)
  \\
  = \frac{1}{4\pi} \grad \vd\vec{F}(\vec{x}, t) -
  \frac{1}{4\pi} \vec{\Omega}\vd \grad \phi(\vec{x}, t)
  \equiv \hat Q(\vec{x}, \vec{\Omega}, t)\,,
  \qquad
x \in V,\  0 \le t \le \Delta_t, \ \vec{\Omega} \in 4\pi.
\end{multline}
However, we will define incident boundary conditions for this internal solution
to be
\begin{equation} \label{eq:tCapPsiBndy}
 \tilde\Psi(\vec{x}, \vec{\Omega}, t) 
  = - \zeta(\vec{x}, \vec{\Omega}, t) \vec{\Omega}\vd \grad \phi(\vec{x}, t)
  \equiv \tilde\Psi^b(\vec{x}, \vec{\Omega}, t) \,,
\end{equation}
for $\vec{x} \in \partial V_b$, $\vec{\Omega} \vd \vec{n} < 0$,
$0 \le t \le \Delta_t$. The function $\zeta$, which lives on the boundary for
incident directions, is yet
to be determined. This unusual boundary condition will be justified later.
The reflecting boundary condition is effectively unchanged from
Eq.~\eqref{eq:capPsiRefl}:
\begin{equation} \label{eq:tCapPsiRefl}
 \tilde\Psi(\vec{x}, \vec{\Omega}, t) 
  = \tilde\Psi(\vec{x}, \vec{\Omega}_r, t)
  \equiv \tilde\Psi^b(\vec{x}, \vec{\Omega}, t) \,,
\end{equation}
for $\vec{x} \in \partial V_r$, $\vec{\Omega} \vd \vec{n} < 0$,
$0 \le t \le \Delta_t$.
Finally, the internal solution contains the same initial condition as
Eq.~\eqref{eq:capPsiInit}:
\begin{equation} \label{eq:tCapPsiInit}
 \tilde\Psi(\vec{x}, \vec{\Omega}, 0)
 = \Psi^i(\vec{x}, \vec{\Omega}, t)\,.
\end{equation}
\end{subequations}

The corresponding transport problem for $\Psi_\mathrm{bl}$ is defined to
satisfy the transport equations for $\Psi$ using the definition in
Eq.~\eqref{eq:boundaryLayerPsi}.
\begin{subequations} \label{eqs:blCapPsi}
It has the same left-hand side as Eq.~\eqref{eq:capPsiBndy} but no internal
source:
\begin{equation} \label{eq:blCapPsiVol}
  \frac{1}{c} \pder{}{t}\Psi_\mathrm{bl}(\vec{x}, \vec{\Omega}, t)
    + \vec{\Omega}\vd \grad \Psi_\mathrm{bl}(\vec{x}, \vec{\Omega}, t)
    + \sigma^\ast(\vec{x}) \Psi_\mathrm{bl}(\vec{x}, \vec{\Omega}, t)
  = 0\,, \quad
x \in V,\  0 \le t \le \Delta_t, \ \vec{\Omega} \in 4\pi.
\end{equation}
The incident boundary condition accounts for the true incident boundary source
as well as the $\zeta$ term we introduced:
\begin{equation} \label{eq:blCapPsiBndy}
 \Psi_\mathrm{bl}(\vec{x}, \vec{\Omega}, t) 
  = I^b(\vec{x}, \vec{\Omega}, t) - \frac{1}{4\pi} \phi(\vec{x}, t)
  + \zeta(\vec{x}, \vec{\Omega}, t) \vec{\Omega}\vd \grad \phi(\vec{x}, t)
  \equiv \Psi_\mathrm{bl}^b(\vec{x}, \vec{\Omega}, t) \,.
\end{equation}
For $\vec{x} \in \partial V_r$, the boundary layer solution is reflecting:
\begin{equation} \label{eq:blCapPsiRefl}
 \Psi_\mathrm{bl}(\vec{x}, \vec{\Omega}, t) 
  = \Psi_\mathrm{bl}(\vec{x}, \vec{\Omega}_r, t)\,.
\end{equation}
Finally, because $\tilde\Psi$ accounts for the initial condition, the initial
condition for $\Psi_\mathrm{bl}$ is zero:
Eq.~\eqref{eq:capPsiInit}:
\begin{equation} \label{eq:blCapPsiInit}
 \Psi_\mathrm{bl}(\vec{x}, \vec{\Omega}, 0)
 = 0\,.
\end{equation}
\end{subequations}

If we add Eqs.~\eqref{eqs:blCapPsi} to Eqs.~\eqref{eqs:tCapPsi}, we recover the
original transport equation for $\Psi$. However, unlike the original transport
equation,
Eqs.~\eqref{eqs:tCapPsi} and~\eqref{eqs:blCapPsi} allow us to formulate boundary
conditions for the anisotropic diffusion method.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Integral transport equation}
The integral transport equation is formulated \cite{Pri2010} by taking the
right-hand side of a transport equation to be a known quantity, then integrating
along the characteristic ray $\vec{\Omega}$, accumulating particles born along
the ray and attenuating by collisions during their flight. Instead of considering
the integral
transport equation for $I$, we invert Eqs.~\eqref{eqs:tCapPsi} to express
the internal solution $\tilde\Psi$ as an integral:
\begin{subequations} \label{eqs:inverseTransport}
  \begin{align} \label{eq:inverseTransportFull}
  \begin{split}
    \tilde\Psi(\vec{x}, \vec{\Omega}, t)
    &=
    \tilde\Psi^b(\vec{x} - s_b\vec{\Omega}, \vec{\Omega}, t - s_b/c)
    \eexp^{ -\tau(\vec{x}, \vec{x} - s_b \vec{\Omega})}
    U(ct - s_b)
    \\
    &\qquad + \Psi^i( \vec{x} - ct \vec{\Omega}, \vec{\Omega})
    \eexp^{ -\tau(\vec{x}, \vec{x} - ct \vec{\Omega})}
    U( s_b - ct)
    \\
    &\qquad +  \int_{0}^{s_b}
    \left[ \hat Q(\vec{x} - s \vec{\Omega}, \vec{\Omega}, t-s/c)
    \right]
    \eexp^{ -\tau(\vec{x}, \vec{x} - s \vec{\Omega})}
    \ud s
\,.
  \end{split}
  \end{align}
  Here, $U(v)$ is the Heaviside function, unity for $v \ge 0$ and zero
  otherwise. The optical thickness of the medium between points $\vec{x}$ and
  $\vec{x}'$ along the direction $\vec{\Omega} = (\vec{x}'-
  \vec{x})/\norm{\vec{x}'-\vec{x}}$ is 
  \begin{equation} \label{eq:fullTauDefinition}
    \tau(\vec{x}, \vec{x}') = \int_{0}^{\norm{\vec{x} -
    \vec{x}'}} \sigma^\ast(\vec{x}-s\vec{\Omega}) \ud s \,.
  \end{equation}
  The quantity $s_b$ is the distance to the boundary along $-\vec{\Omega}$ from
  $\vec{x}$.
\end{subequations}

For brevity, we write Eq.~\eqref{eq:inverseTransportFull} as a sum of linear
operators, each of which corresponds to the local contribution of a nonlocal
particle source:
\begin{align} \nonumber
  \tilde\Psi(\vec{x}, \vec{\Omega}, t)
    &\equiv \lopinv{b}{\tilde\Psi^b}
    + \lopinv{i}{\Psi^i}
    + \lopinv{v}{\hat Q}
    \\ \label{eq:inverseTransportBrief}
  \begin{split}
    \tilde\Psi(\vec{x}, \vec{\Omega}, t)
    &\equiv
    -\lopinv{b}{\zeta \vec{\Omega}\vd \grad \phi}_{\partial V_b}
    + \lopinv{b}{\tilde\Psi(\vec{x}, \vec{\Omega}_r, t)}_{\partial V_r}
    + \lopinv{i}{\Psi^i}
  \\&\qquad
    + \lopinv{v}{\frac{1}{4\pi} \grad \vd\vec{F} }
    - \lopinv{v}{\frac{1}{4\pi} \vec{\Omega}\vd \grad \phi}
    \,.
  \end{split}
\end{align}

No approximations or assumptions at all have been made yet. As a
result, the inverse equation~\eqref{eq:inverseTransportFull} still contains
the unknowns $\phi$ and $\vec{F}$ (as well as the exiting $\tilde\Psi$ on
any reflecting boundaries), and the local value of
$\tilde\Psi$ depends on the global value of those unknowns.

Our goal is to make reasonable approximations to this equation that yield a
low-order approximation to $\vec{F}=\int_{4\pi}\vec{\Omega} \tilde\Psi
\ud\Omega$, one which
depends only on local unknowns and nonlocal knowns.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Asymptotic ansatz and expansions}
To simplify the integral transport
equation~\eqref{eq:inverseTransportBrief}, it is necessary to make some
approximations. We make an ansatz that the spatial gradients of the intensity
are weak, the intensity varies slowly in time, and the solution is mildly
(but not necessarily linearly) anisotropic:
\begin{align} \label{eq:ansatz}
  I &= O(1), &
  \grad I &= O(\epsilon), &
  \frac{1}{c}\pder{I}{t} &= O(\epsilon^2), &
  \int_{4\pi} \vec{\Omega} I\ud\Omega &= O(\epsilon).
\end{align}

The contribution from $\grad \vd\vec{F}$ is $O(\epsilon^2)$, as the term
contains an $O(\epsilon)$ derivative as well as the $O(\epsilon)$ radiation
flux.  The assumption about the speed of light being very large means that the
contribution from the initial condition is $O(\epsilon^2)$.

To derive the anisotropic diffusion method, we first discard the $O(\epsilon^2)$
terms that appear in Eq.~\eqref{eq:inverseTransportBrief}:
\begin{equation} \label{eq:approxPsi1}
  \tilde\Psi \approx 
  -\lopinv{b}{\zeta \vec{\Omega}\vd \grad \phi}_{\partial V_b}
  + \lopinv{b}{\tilde\Psi(\vec{\Omega}_r)}_{\partial V_r}
  - \lopinv{v}{\frac{1}{4\pi} \vec{\Omega}\vd \grad \phi}
  + O(\epsilon^2)
\end{equation}

The ansatz about the gradients allows the nonlocal variables in
Eq.~\eqref{eq:inverseTransportFull} to be expanded about
the local spatiotemporal point:
\begin{equation} \label{eq:taylorPhi}
  \phi(\vec{x} - s \vec{\Omega}, t-s/c)
  \sim \phi(\vec{x},t) - s \left( \frac{1}{c} \pder{}{t} + \vec{\Omega} \vd
  \grad  \right) \phi (\vec{x}, t) + O(\epsilon^2) \sim \phi(\vec{x},t) +
  O(\epsilon) \,.
\end{equation}
This Taylor series will enable, to leading order, the approximation of nonlocal
quantities inside the operators $\lopinv{}{\cdot}$ by local quantities.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Approximating the streaming term}
The streaming term in Eq.~\eqref{eq:approxPsi1} is (see
Eq.~\eqref{eq:inverseTransportFull}):
\begin{align*}
- \lopinv{v}{\frac{1}{4\pi} \vec{\Omega}\vd \grad \phi(\vec{x}, t)}
  &= \int_{0}^{\norm{\vec{x} - \vec{x}_b}}
    \left[ -\frac1{4\pi}\vec{\Omega}\vd \grad \phi(\vec{x} - s \vec{\Omega},
    t-s/c)
    \right]
    \eexp^{ -\tau(\vec{x}, \vec{x} - s \vec{\Omega})}
    \ud s
\end{align*}
This integral describes the contribution from the volumetric source  along
$\vec{\Omega}$, evaluated at a prior
point in time ($t-s/c$, the point along $s$ at which a particle would travel
to $\vec{x}$ at time $t$), attenuated by the medium along the way (the
$\eexp^{ -\tau }$ factor).

We now make our first approximation by expanding the distant $\phi(\vec{x} - s
\vec{\Omega}, t-s/c)$ about the local $\phi(\vec{x}, t)$ using
Eq.~\eqref{eq:taylorPhi}. Thus,
\begin{equation*}
  \grad \phi(\vec{x} - s \vec{\Omega}, t-s/c)
  = \grad \left[ \phi(\vec{x}, t) + O(\epsilon) \right]
  = \grad \phi(\vec{x}, t) + O(\epsilon^2).
\end{equation*}
The expansion is a good approximation if $\phi$ is smooth, especially because the
$\eexp^{ -\tau }$ term exponentially attenuates the non-local components of the
Taylor series as $s$ increases, assuming $\sigma\ne 0$ along the ray
$\vec{\Omega}$.

We can now move the unknown $\phi$ outside the integral,
because it is no longer a function of $s$:
\begin{align}\nonumber
- \lopinv{v}{\frac{1}{4\pi} \vec{\Omega}\vd \grad \phi(\vec{x}, t)}
  &\approx \int_{0}^{\norm{\vec{x} - \vec{x}_b}}
    \left[ -\frac1{4\pi}\vec{\Omega}\vd \grad \phi(\vec{x},t) \right]
    \eexp^{ -\tau(\vec{x}, \vec{x} - s \vec{\Omega})}
    \ud s
  \\\nonumber
  &= - \int_{0}^{\norm{\vec{x} - \vec{x}_b}}
    \left[ \frac1{4\pi}\right]
    \eexp^{ -\tau(\vec{x}, \vec{x} - s \vec{\Omega})} \ud s \,
    \vec{\Omega}\vd \grad \phi(\vec{x},t)
  \\\label{eq:streamingApprox}
  &= - \lopinv{v}{ \frac1{4\pi} } \vec{\Omega}\vd \grad \phi(\vec{x},t)
  \,.
\end{align}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Approximating the incident boundary term}
The incident boundary term in Eq.~\eqref{eq:approxPsi1} is
\begin{multline*}
-\lopinv{b}{\zeta \vec{\Omega}\vd \grad \phi}_{\partial V_b}
  = -\left[\zeta(\vec{x} - s_b\vec{\Omega}, \vec{\Omega}, t - s_b/c)
   \vec{\Omega}\vd \grad \phi(\vec{x} - s_b\vec{\Omega}, t - s_b/c) \right]
   \\
\times
    \eexp^{ -\tau(\vec{x}, \vec{x} - s_b \vec{\Omega})}
    U(ct - s_b) \,.
\end{multline*}
It accounts for particles that start their life at a specified incident boundary
inside the current time step and stream along $\vec{\Omega}$, attenuated by
$\eexp^{-\tau}$ along their path. As the optical thickness between
$(\vec{x})$ and the boundary increases, this term vanishes
exponentially fast.

Now we apply the Taylor series expansion from Eq.~\eqref{eq:taylorPhi} to
$\phi$, but not to $\zeta$:
\begin{equation*}
  \grad \phi(\vec{x} - s_b\vec{\Omega}, t - s_b/c)
  \approx \grad \phi(\vec{x}, t) + O(\epsilon^2)\,,
\end{equation*}
and we discard the $O(\epsilon^2)$ term. This gives
\begin{align} \nonumber
-\lopinv{b}{\zeta \vec{\Omega}\vd \grad \phi}_{\partial V_b}
&\approx -\left[\zeta(\vec{x} - s_b\vec{\Omega}, \vec{\Omega}, t - s_b/c) \right]
  \eexp^{ -\tau(\vec{x}, \vec{x} - s_b \vec{\Omega})} U(ct - s_b)
  \vec{\Omega}\vd \grad \phi
 \\ \label{eq:bndyApprox}
&= -\lopinv{b}{\zeta}_{\partial V_b} \vec{\Omega}\vd \grad \phi(\vec{x}, t) \,.
\end{align}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Approximating the reflecting boundary term}\label{sec:derReflBc}
For a moment, let us consider a problem without reflecting boundaries, so
$\partial V_b = \partial V$. At this point, Eq.~\eqref{eq:approxPsi1} has been
reduced to
\begin{align*}
  \tilde\Psi
  &= -\lopinv{b}{\zeta \vec{\Omega}\vd \grad \phi}
    + \lopinv{i}{\Psi^i}
    + \lopinv{v}{\frac{1}{4\pi} \grad \vd\vec{F} }
    - \lopinv{v}{\frac{1}{4\pi} \vec{\Omega}\vd \grad \phi}
\\
  &\approx
  -\lopinv{b}{\zeta} \vec{\Omega}\vd \grad \phi
  - \lopinv{v}{\frac{1}{4\pi}} \vec{\Omega}\vd \grad \phi \,.
\end{align*}
Now the decision to choose the particular form for the boundary condition in
Eq.~\eqref{eq:tCapPsiBndy}
is clear: under the systematic approximations made so far, the internal solution
$\tilde\Psi$ can be written
\begin{equation*}
  \tilde\Psi(\vec{x}, \vec{\Omega}, t)
  = - \left\{ \lopinv{b}{\zeta} + \lopinv{v}{\frac{1}{4\pi}}
  \right\} \vec{\Omega}\vd \grad \phi
  \equiv - f(\vec{x}, \vec{\Omega}) \vec{\Omega}\vd \grad \phi(\vec{x}, t)\,.
\end{equation*}
Let us assume that an approximation to the reflecting boundary condition can
be made that, in the general case with mixed reflecting and incident
boundaries, also allows us to write 
\begin{equation*}
  \tilde\Psi(\vec{x}, \vec{\Omega}, t)
  \approx - f(\vec{x}, \vec{\Omega}) \vec{\Omega}\vd \grad \phi(\vec{x}, t)\,.
\end{equation*}

Substituting this approximation into the reflecting boundary term in
Eq.~\eqref{eq:inverseTransportBrief} yields
\begin{align*}
\lopinv{b}{\tilde\Psi(\vec{\Omega}_r)}_{\partial V_r}
  &= \left[\tilde\Psi(\vec{x} - s_b\vec{\Omega}, \vec{\Omega}_r, t - s_b/c)
  \right]
    \eexp^{ -\tau(\vec{x}, \vec{x} - s_b \vec{\Omega})}
    U(ct - s_b)
\\
  &= \left[-f(\vec{x} - s_b\vec{\Omega}, \vec{\Omega}_r) \vec{\Omega}_r 
  \vd \grad \phi(\vec{x} - s_b\vec{\Omega}, t - s_b/c) \right]
  \eexp^{ -\tau(\vec{x}, \vec{x} - s_b \vec{\Omega})}
  U(ct - s_b) \,.
\\ 
\intertext{First, we expand $\vec{\Omega}_r$ using Eq.~\eqref{eq:reflection}.
}
\lopinv{b}{\tilde\Psi(\vec{\Omega}_r)}_{\partial V_r}
  &= - \lopinv{b}{f(\vec{x} - s_b\vec{\Omega}, \vec{\Omega}_r)
\left(  \vec{\Omega} - 2(\vec{\Omega} \vd \vec{n}) \vec{n} \right)
  \vd \grad \phi(\vec{x} - s_b\vec{\Omega}, t - s_b/c) }
  \\
  &= -\lopinv{b}{f(\vec{x}_b,\vec{\Omega}) \vec{\Omega} \vd \grad
  \phi(\vec{x}_b,t)}
  + \lopinv{b}{f(\vec{x}_b,\vec{\Omega}) 2(\vec{\Omega} \vd \vec{n}) \vec{n} \vd
  \grad \phi(\vec{x}_b,t) } \,.
\\ 
\intertext{On a reflecting boundary at any point $\vec{x}_b$, the exact
intensity satisfies $\vec{n} \vd
\grad I = 0$, which also means $\vec{n} \vd \grad \phi=0$. Thus, the second
term is zero, and the reflecting boundary term is
}
\lopinv{b}{\tilde\Psi(\vec{\Omega}_r)}_{\partial V_r}
&= -\lopinv{b}{f \vec{\Omega} \vd \grad \phi} \,.
\\ \intertext{Now, as with in the incident boundary condition, we apply the
Taylor
series expansion from Eq.~\eqref{eq:taylorPhi} to $\phi$ but not to $f$:
}
\lopinv{b}{\tilde\Psi(\vec{\Omega}_r)}_{\partial V_r}
&\approx
-\left[f(\vec{x} - s_b\vec{\Omega}, \vec{\Omega}_r)
  \right]
  \eexp^{ -\tau(\vec{x}, \vec{x} - s_b \vec{\Omega})}
  U(ct - s_b) \vec{\Omega} \vd \grad \phi(\vec{x}, t)\,,
\end{align*}
or, in the more simplified form,
\begin{equation} \label{eq:reflApprox}
\lopinv{b}{\tilde\Psi(\vec{\Omega}_r)}_{\partial V_r}
\approx  
- \lopinv{b}{f(\vec{\Omega}_r)}_{\partial V_r}
\vec{\Omega} \vd \grad \phi(\vec{x}, t) \,.
\end{equation}

This has the same form as the other approximations to the term, a property crucial
to forming the anisotropic diffusion approximation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Completed approximation to the anisotropic intensity}
Substituting Eqs.~\eqref{eq:streamingApprox},~\eqref{eq:bndyApprox},
and~\eqref{eq:reflApprox} into Eq.~\eqref{eq:approxPsi1} gives a nearly complete
approximation to the anisotropic intensity:
\begin{align} \nonumber
  \tilde\Psi
  &\approx 
- \lopinv{b}{\zeta}_{\partial V_b} \vec{\Omega}\vd \grad \phi
- \lopinv{b}{f(\vec{\Omega}_r)}_{\partial V_r}
  \vec{\Omega}\vd \grad \phi
- \lopinv{v}{\frac{1}{4\pi}}  \vec{\Omega}\vd \grad \phi
\\ \label{eq:approxPsi2}
  \tilde\Psi &= 
- \left\{ \lopinv{b}{\zeta}_{\partial V_b} 
+ \lopinv{b}{f(\vec{\Omega}_r)}_{\partial V_r}
+ \lopinv{v}{\frac{1}{4\pi}} \right\} \vec{\Omega}\vd \grad \phi
\\ \label{eq:approxPsi3}
\tilde\Psi(\vec{x}, \vec{\Omega}, t) &= - f(\vec{x}, \vec{\Omega})
\vec{\Omega}\vd \grad \phi(\vec{x}, t)\,.
\end{align}

Here, we have defined
\begin{equation*}
  f(\vec{x}, \vec{\Omega})
  \equiv \lopinv{b}{\zeta}_{\partial V_b} 
+ \lopinv{b}{f(\vec{\Omega}_r)}_{\partial V_r}
+ \lopinv{v}{\frac{1}{4\pi}}\,,
\end{equation*}
which is an integral transport equation (see Eqs.~\eqref{eqs:inverseTransport}).
Converting the integral transport equation to a differential
transport equation, we see that $f$ is the solution of a purely absorbing
transport equation with a uniform, isotropic source:
\begin{subequations} \label{eqs:fFull}
  \begin{equation} \label{eq:fFullVol}
    \vec{\Omega}\vd \grad f(\vec{x}, \vec{\Omega})
    + \sigma^\ast f (\vec{x}, \vec{\Omega})
  = \frac{1}{4\pi} \,, \quad x \in V,\ \vec{\Omega} \in 4\pi\,,
  \end{equation}
with to-be-determined boundary conditions where the incident radiation $I$ is specified,
\begin{equation} \label{eq:fFullBndy}
  f(\vec{x}, \vec{\Omega}) = \zeta(\vec{x}, \vec{\Omega}) \,,
 \quad \vec{x} \in \partial V_b, \ \vec{\Omega} \vd \vec{n} < 0\,.
\end{equation}
  and with reflecting boundary conditions where the physical problem is
  reflecting,
\begin{equation} \label{eq:fFullRefl}
  f(\vec{x}, \vec{\Omega}) = f(\vec{x}, \vec{\Omega}_r) \,,
 \quad \vec{x} \in \partial V_r, \ \vec{\Omega} \vd \vec{n} < 0\,.
\end{equation}
\end{subequations}

We have applied the approximation that $\frac{1}{c}\pder{}{t}= O(\epsilon^2)$
to turn the transport equation for $f$ into a steady-state equation, and we have
accordingly restricted $\zeta$ to a function constant within the time step.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Approximate radiation flux}
Now we have an equation for $\Psi(\vec{x}, \vec{\Omega}, t)$ as a
separable
function of this simple transport equation $f(\vec{x}, \vec{\Omega})$ and the
scalar intensity $\phi(\vec{x},t)$.
We desire a simple low-order equation that provides a closure for the unknown
radiation flux $\vec{F}(\vec{x},t)$ in the radiation conservation
equation~\eqref{eq:loVol}.

To get such a closure, we recall the property from Eq.~\eqref{eq:capPsiFirst}
that the first moment of the anisotropic intensity is the radiation flux. We
therefore apply this identity to our approximate anisotropic intensity from
Eq.~\eqref{eq:approxPsi3}:
\begin{align} \nonumber
  \vec{F}(\vec{x}, t)
  &= \int_{4\pi} \vec{\Omega} \tilde \Psi(\vec{x}, \vec{\Omega}, t) \ud\Omega
  \\ \nonumber
  &= 
  - \left[ \int_{4\pi} \vec{\Omega} \vec{\Omega} f(\vec{x}, \vec{\Omega})
  \ud\Omega \right]
  \vd \grad \phi(\vec{x},t)
  \\ \label{eq:anisotropicFicks}
  &= - \Dtens(\vec{x}) \vd \grad \phi(\vec{x},t) \,.
\end{align}
This resembles ``Fick's law,'' but instead of a scalar diffusion \emph{coefficient},
the anisotropic diffusion method has a diffusion \emph{tensor}, $\Dtens$, the
second angular moment of $f$:
\begin{equation}\label{eq:dDefinition}
  \Dtens(\vec{x}) \equiv \int_{4\pi} \vec{\Omega} \vec{\Omega}
  f(\vec{x}, \vec{\Omega}) \ud\Omega \,.
\end{equation}

Analogous to Fick's law for diffusion, it is
substituted into the time-dependent conservation equation to provide a simple
approximate equation for the scalar intensity:
\begin{equation*}
  -\grad \vd \Dtens \phi + \sigma^\ast \phi = \sigma^\ast ac T^4 + q_{r} \,.
\end{equation*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Boundary conditions}\label{sec:derBc}

In this section, we use the boundary layer equations~\eqref{eqs:blCapPsi} to
address the connected issues of appropriate boundary
conditions for the low-order anisotropic diffusion equations and the boundary
condition $\zeta$ used in the transport calculation for $f$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Incident boundary conditions}
A boundary layer analysis 
{\small [citation needed]}
shows that the transport boundary layer, the solution of
Eqs.~\eqref{eqs:blCapPsi}, decays most rapidly under the condition
\begin{equation} \label{eq:bcW}
  0 = \int_{\vec{\Omega} \vd \vec{n} < 0} W(\abs{\vec{\Omega} \vd \vec{n}})
  \Psi_\mathrm{bl} (\vec{x}, \vec{\Omega}, t) \ud \Omega\,,\qquad \vec{x} \in
  \partial V_b\,.
\end{equation}
$W$ is related to Chandrasekhar's $H$-function \cite{Cha1960} and is
well-approximated by a simple polynomial \cite{Mal1991}:
\begin{equation} \label{eq:chandraW}
  W(\mu) = \frac{\sqrt{3}}{2} \mu H(\mu)
  \approx \mu + \tfrac{3}{2} \mu^2 \,.
\end{equation}
To recover the Marshak boundary condition, we could use $W(\mu) \approx 2 \mu$.

Substituting Eq.~\eqref{eq:blCapPsiBndy} into Eq.~\eqref{eq:bcW} gives the
low-order boundary condition for anisotropic diffusion:
\begin{equation*}
  0 = \int_{\vec{\Omega} \vd \vec{n} < 0} W(\abs{\vec{\Omega} \vd \vec{n}})
  \left[  I^b(\vec{x}, \vec{\Omega}, t) - \frac{1}{4\pi} \phi(\vec{x}, t)
  + \zeta(\vec{x}, \vec{\Omega}, t) \vec{\Omega}\vd \grad \phi(\vec{x}, t)
\right] \ud \Omega \,,
\end{equation*}
or
\begin{equation} \label{eq:bcInc1}
  2\int_{\vec{\Omega}\vd \vec{n} < 0}
  W(\abs{\vec{\Omega} \vd \vec{n}}) I^b(\vec{x}, \vec{\Omega}, t) \ud\Omega
  = \phi(\vec{x}, t)
  - 2\int_{\vec{\Omega}\vd \vec{n} < 0} W(\abs{\vec{\Omega} \vd \vec{n}})
  \zeta(\vec{x}, \vec{\Omega}) \vec{\Omega} \ud\Omega
  \vd \grad \phi(\vec{x}, t) \,.
\end{equation}

\subsubsection{Determining $\zeta$}\label{sec:determiningZeta}
The unknown function $\zeta(\vec{x}, \vec{\Omega})$ that lives on the boundary
is a degree of freedom introduced at the beginning of the anisotropic
diffusion derivation. It allowed us to formulate a specified boundary condition
such that the effect of $\zeta$ could be embedded in the anisotropic diffusion
tensor $\Dtens$.

To make use of this degree of freedom, we decide to enforce on the boundary the
truth from Eq.~\eqref{eq:capPsiZeroth},
\begin{equation*}
  \int_{4\pi} \Psi(\vec{x}, \vec{\Omega}, t) \ud\Omega
  = 0 \,.
\end{equation*}
Note that our approximate $\tilde\Psi$ defined in Eq.~\eqref{eq:approxPsi3}
does not generally satisfy this identity:
\begin{align*}
  0
&\qeq \int_{4\pi} \tilde\Psi(\vec{x}, \vec{\Omega}, t) \ud\Omega
\\
0 &\qeq \int_{4\pi} \left[ - f(\vec{x}, \vec{\Omega}) \vec{\Omega}
\vd \grad \phi(\vec{x}, t)\right]
\ud\Omega
\\
0 &\qeq \int_{4\pi} \vec{\Omega} f(\vec{x}, \vec{\Omega})\ud\Omega \,.
\end{align*}
However, on exterior source boundaries, because $\zeta$ is defined for incident
directions and $f$ is known for exiting directions, we can choose $\zeta$ such
that this identity is satisfied under certain conditions.

Returning to the description of $f$ on an incident boundary in
Eq.~\eqref{eq:fFullBndy}, we write
\begin{align*}
  \int_{4\pi} \vec{\Omega} f(\vec{x}, \vec{\Omega})\ud\Omega
  &= \int_{\vec{\Omega} \vd \vec{n} < 0}
  \vec{\Omega} \zeta(\vec{x}, \vec{\Omega})\ud\Omega
  + \int_{\vec{\Omega} \vd \vec{n} > 0}
  \vec{\Omega} f(\vec{x}, \vec{\Omega})\ud\Omega\,.
\end{align*}
Now we set the left hand side to zero, demanding that
Eq.~\eqref{eq:capPsiZeroth} be satisfied:
\begin{align} \nonumber
  \int_{\vec{\Omega} \vd \vec{n} < 0}
  \vec{\Omega} \zeta(\vec{x}, \vec{\Omega})\ud\Omega
  &= -\int_{\vec{\Omega} \vd \vec{n} > 0}
  \vec{\Omega} f(\vec{x}, \vec{\Omega})\ud\Omega \,.
  \\ 
  \intertext{Making the substitution $\vec{\Omega}\to -\vec{\Omega}$ on the
  right hand side yields}
  \label{eq:zetaCondition}
  \int_{\vec{\Omega} \vd \vec{n} < 0}
  \vec{\Omega} \zeta(\vec{x}, \vec{\Omega})\ud\Omega
  &= \int_{\vec{\Omega} \vd \vec{n} < 0}
  \vec{\Omega} f(\vec{x}, -\vec{\Omega})\ud\Omega \,.
\end{align}

If $f(\vec{\Omega})$ is azimuthally symmetric about $\vec{n}$, then $f$ is only
a function of the cosine angle between $\vec{\Omega}$ and $\vec{n}$:
\begin{equation*}
f(\vec{\Omega}) = \hat f( \vec{\Omega} \vd \vec{n})\,.
\end{equation*}
Now recall the definition of a reflecting boundary from
Eq.~\eqref{eq:reflection},
\begin{equation*}
  \vec{\Omega}_r = \vec{\Omega} - 2(\vec{\Omega} \vd \vec{n}) \vec{n}\,.
\end{equation*}
Dotting the reflected vector with the normal vector $\vec{n}$,
\begin{equation*}
  \vec{\Omega}_r \vd \vec{n}
  = \vec{\Omega} \vd \vec{n} - 2(\vec{\Omega} \vd \vec{n}) \vec{n}\vd \vec{n}
  = - \vec{\Omega} \vd \vec{n}\,.
\end{equation*}
Thus,
\begin{equation*}
  \hat f( \vec{\Omega}_r \vd \vec{n}) = \hat f( -\vec{\Omega} \vd \vec{n})
\end{equation*}
and
\begin{equation}\label{eq:aziSymResult}
  f( \vec{\Omega}_r) = f( -\vec{\Omega} )\,.
\end{equation}

Therefore, if $f$ is azimuthally symmetric about $\vec{n}$ on the
boundary, Eq.~\eqref{eq:zetaCondition} can be written
\begin{equation}\label{eq:zetaCondition2}
  \int_{\vec{\Omega} \vd \vec{n} < 0}
  \vec{\Omega} \zeta(\vec{x}, \vec{\Omega})\ud\Omega
  = \int_{\vec{\Omega} \vd \vec{n} < 0}
  \vec{\Omega} f(\vec{x}, \vec{\Omega}_r)\ud\Omega \,,
\end{equation}
which is satisfied by
\begin{equation} \label{eq:zeta}
  \zeta(\vec{x}, \vec{\Omega}) = f(\vec{x}, \vec{\Omega}_r) \,,
 \quad \vec{x} \in \partial V_b, \ \vec{\Omega} \vd \vec{n} < 0 \,.
\end{equation}
This is not the only definition that satisfies Eq.~\eqref{eq:zetaCondition},
but it straightforward and has the advantage that all half-space angular moments
of $\zeta$ are equal to $f$, an identity that is used to derive Marshak-like
boundary conditions later.

Now the boundary condition for $f$ in Eq.~\eqref{eq:fFullBndy} becomes
\begin{equation} \label{eq:fFullBndy2}
  f(\vec{x}, \vec{\Omega}) = f(\vec{x}, \vec{\Omega}_r) \,,
 \quad \vec{x} \in \partial V_b, \ \vec{\Omega} \vd \vec{n} < 0\,.
\end{equation}
This says that under the approximations, assumptions, and restrictions we made,
the transport equation for $f$ has reflecting boundaries everywhere, even
where the physical problem does \emph{not} have reflecting boundaries.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Low-order boundary conditions}
With a definition for $\zeta$ in hand, we return to Eq.~\eqref{eq:bcInc1} and
substitute Eq.~\eqref{eq:zeta}, dropping the argument $\vec{x}$ for brevity:
\begin{equation*}
  2\int_{\vec{\Omega}\vd \vec{n} < 0}
  W(\abs{\vec{\Omega} \vd \vec{n}}) I^b(\vec{\Omega}) \ud\Omega
  = \phi
  - 2\int_{\vec{\Omega}\vd \vec{n} < 0} W(\abs{\vec{\Omega} \vd \vec{n}})
  \vec{\Omega} f(\vec{\Omega}_r) \ud\Omega
  \vd \grad \phi \,.
\end{equation*}
We can make the right-hand side clearer by expressing the integral over exiting
values of $f$. Making the substitution $\vec{\Omega}\to-\vec{\Omega}$ in the
integral, we get
\begin{align*}
  - 2\int_{\vec{\Omega}\vd \vec{n} < 0} W(\abs{\vec{\Omega} \vd \vec{n}})
  \vec{\Omega} f(\vec{\Omega}_r) \ud\Omega
  &= 
  - 2\int_{\vec{\Omega}\vd \vec{n} > 0} W(\abs{-\vec{\Omega} \vd \vec{n}})
  ( - \vec{\Omega}) f(-\vec{\Omega}_r) \ud\Omega
  \\
  &= 
  2\int_{\vec{\Omega}\vd \vec{n} > 0} W(\vec{\Omega} \vd \vec{n})
  \vec{\Omega} f(-\vec{\Omega}_r) \ud\Omega
  \\ 
  &= 
  2\int_{\vec{\Omega}\vd \vec{n} > 0} W(\vec{\Omega} \vd \vec{n})
  \vec{\Omega} f(\vec{\Omega}) \ud\Omega \,.
\end{align*}
The boundary condition on $f$ from Eq.~\eqref{eq:fFullBndy2} in conjunction
with Eq.~\eqref{eq:aziSymResult} give the equality $f(-\vec{\Omega}_r) =
f(\vec{\Omega})$.

The low-order, transport-consistent boundary condition for an incident source
is therefore
\begin{equation}\label{eq:loBndy}
  2\int_{\vec{\Omega}\vd \vec{n} < 0}
  W(\abs{\vec{\Omega} \vd \vec{n}}) I^b(\vec{x}, \vec{\Omega}, t) \ud\Omega
  = \phi(\vec{x}, t)
  + 2\int_{\vec{\Omega}\vd \vec{n} > 0} W(\vec{\Omega} \vd \vec{n})
  \vec{\Omega} f(\vec{x}, \vec{\Omega}) \ud\Omega
  \vd \grad \phi(\vec{x}, t) \,.
\end{equation}
This form has a particular advantage if we use the Marshak-like approximation
that $W(\mu)\approx 2\mu$. Equation~\eqref{eq:loBndy} becomes
\begin{align*}
  2\int_{\vec{\Omega}\vd \vec{n} < 0}
  ( 2\abs{\vec{\Omega} \vd \vec{n}} ) I^b(\vec{\Omega}) \ud\Omega
  &= \phi
  + 2\int_{\vec{\Omega}\vd \vec{n} > 0} ( 2\vec{\Omega} \vd \vec{n} )
  \vec{\Omega} f(\vec{\Omega}) \ud\Omega \vd \grad \phi
  \\
  4 F^-
  &= \phi
  + 4 \vec{n} \vd \left[ \int_{\vec{\Omega}\vd \vec{n} > 0} \vec{\Omega}
  \vec{\Omega} f(\vec{\Omega}) \ud\Omega \right] \vd \grad \phi \,.
  \\ 
  \intertext{We chose the boundary condition on $f$ to ensure that it is an
  even function of $\vec{\Omega}$ on the boundary. Therefore, the integrand in
  brackets is an even function of $\vec{\Omega}$, so}
  4 F^-
  &= \phi
  + 4 \vec{n} \vd  \left[ \frac{1}{2} \int_{4\pi}
  \vec{\Omega} \vec{\Omega} f(\vec{\Omega}) \ud\Omega \right] \vd \grad \phi \,.
  \\
  4 F^-
  &= \phi
  + 2 \vec{n} \vd \int_{4\pi}
  \vec{\Omega} \vec{\Omega} f(\vec{\Omega}) \ud\Omega \vd \grad \phi \,.
\end{align*}
The integral on the right hand side is the same as in
  Eq.~\eqref{eq:anisotropicFicks}, which defined the anisotropic diffusion
  tensor. Our Marshak-like boundary approximation is
\begin{equation}\label{eq:marshakAd}
  4 F^-(\vec{x}, t)
  = \phi(\vec{x}, t)
  + 2 \vec{n} \vd \Dtens(\vec{x}) \vd \grad \phi(\vec{x}, t) \,.
\end{equation}
This is entirely analogous to the standard diffusion Marshak boundary condition,
\begin{equation*}
  4 F^-(\vec{x}, t) = \phi(\vec{x}, t)
  + 2  D(\vec{x}) \vec{n} \vd \grad \phi(\vec{x}, t)\,.
\end{equation*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Reflecting boundary conditions}
A reflecting boundary, as described by Eq.~\eqref{eq:fullTransportRefl}, 
implies
\begin{equation}\label{eq:reflFirst}
  \vec{n} \vd \vec{F}(\vec{x}, t) = 0\,.
\end{equation}

Substituting Eq.~\eqref{eq:anisotropicFicks}, the first moment of the AD
approximation to $\tilde\Psi$, we find
\begin{equation}\label{eq:reflLo1}
  \vec{n} \vd \Dtens(\vec{x}) \vd \grad \phi(\vec{x}, t) = 0\,.
\end{equation}
As noted before, the exact intensity on a reflecting boundary also satisfies
\begin{equation}\label{eq:reflZeroth}
  \vec{n}\vd\grad \phi(\vec{x}, t) = 0 \,.
\end{equation}
This is only compatible with Eq.~\eqref{eq:reflLo1} when $\vec{n}$ is an
eigenvector of $\Dtens$:
\begin{equation*}
  \vec{n} \vd \Dtens(\vec{x}) = \lambda \vec{n}\,.
\end{equation*}
Interestingly, as shown in the discussion section, this is the case when $f$ is
azimuthally symmetric about
$\vec{n}$, which is exactly what we demanded of $f$ on non-reflecting boundaries.
Therefore, in the interest of consistency with the other boundaries and with the
property of the exact $I$, we use the low-order AD reflecting boundary condition
of
\begin{equation}\label{eq:reflLo2}
  \vec{n} \vd \grad \phi(\vec{x}, t) = 0\,.
\end{equation}

%\begin{align*}
%  D n &= \lambda n \\
%  n\conj D\conj &= \lambda n\conj \\
%  \\ 
%  \intertext{Since the diffusion tensor is symmetric, $D\conj=D$, so}
%  n\conj D &= \lambda n\conj \,.
%\end{align*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Discussion}
Even without numerical results for the anisotropic diffusion equations, a
number of interesting and beneficial properties can be deduced from the
low-order AD equations~\eqref{eq:loVol}, \eqref{eq:anisotropicFicks}, 
\eqref{eq:marshakAd}, and \eqref{eq:reflLo2}; and from the transport equations
for $f$, Eqs.~\eqref{eq:fFullVol},~\eqref{eq:fFullBndy2},
and~\eqref{eq:fFullRefl}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Transport calculation for $f$}

The anisotropic diffusion tensors are calculated from $f$, the solution to the
transport problem:
\begin{equation*}
    \vec{\Omega}\vd \grad f(\vec{x}, \vec{\Omega})
    + \sigma^\ast f (\vec{x}, \vec{\Omega})
  = \frac{1}{4\pi} \,, \quad x \in V,\ \vec{\Omega} \in 4\pi\,,
\end{equation*}
with the boundary condition
\begin{equation*}
  f(\vec{x}, \vec{\Omega}) = f(\vec{x}, \vec{\Omega}_r) \,,
 \quad \vec{x} \in \partial V, \ \vec{\Omega} \vd \vec{n} < 0\,.
\end{equation*}

This is a purely absorbing transport problem with a unit isotropic source,
reflecting boundary conditions, and the same opacities as the physical problem
being simulated. It is steady-state, although it needs to be recalculated at
every time step as $\sigma^*$ changes.\footnote{The problem for $f$ would also
have to be recalculated at every iteration on the nonlinearities if the user
wishes to converge $\sigma^* \to \sigma^{n+1}$.}

Because it is purely absorbing, if the boundaries are many mean free paths
apart, an \SN\ solution of $f$ will take just over one transport sweep to
solve.
%The reflecting boundaries mean that, if a Gauss--Seidel type
%implementation \cite{Zik2000a} is used, all but the first boundary surface
The transport equation has no scattering source to converge.
There is, however, a caveat because of the opposing reflecting boundaries. If
two boundaries on opposite sides of the problem are separated by only a
fraction of a mean free path (e.g., a voided channel), and a very fine angular
quadrature set is used (one with ordinates that are nearly perpendicular to the
boundary), then $f$ will take many iterations to converge.

Another desirable property of $f$ is that, because it is a steady-state
solution, and because only the second moment
$D^{ij}=\int_{4\pi} \Omega^i \Omega^j f \ud\Omega$ needs to be calculated, the
full angle-dependent solution does not need to be stored! This is a tremendous
advantage compared to time-dependent transport, which requires the
memory-intensive storage of $I(\vec{x},\vec{\Omega},t)$.

If the problem is homogeneous ($\sigma^*$ is constant), then the solution is
$f=1/(4\pi\sigma)$. Taking the second moment of $f$ then yields
\begin{equation*}
  \Dtens = \frac{1}{4\pi\sigma} \int_{4\pi} \vec{\Omega} \vec{\Omega} \ud \Omega
  = \frac{1}{3\sigma} \Identitytens\,.
\end{equation*}
Substituting this into the anisotropic Fick's law,
Eq.~\eqref{eq:anisotropicFicks}, we recover the standard Fick's law:
\begin{equation*}
  \vec{F} = - \frac{1}{3\sigma} \grad \phi\,.
\end{equation*}
In other words, for a homogeneous medium, the anisotropic diffusion method
reduces to the standard diffusion method.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Properties of the anisotropic diffusion tensor}
The diffusion tensor is defined in Eq.~\eqref{eq:dDefinition} to be
\begin{equation*}
  \Dtens(\vec{x}) \equiv \int_{4\pi} \vec{\Omega} \vec{\Omega}
  f(\vec{x}, \vec{\Omega}) \ud\Omega \,.
\end{equation*}
Equivalently, the component in row $i$, column $j$ of $\Dtens$ is
\begin{equation}\label{eq:dij}
  D^{ij} = \int_{4\pi} \Omega^i \Omega^j
  f(\vec{x}, \vec{\Omega}) \ud\Omega \,,
\end{equation}
where $\Omega^i$ is the $i$th component of the angular vector $\vec{\Omega}$
(e.g., $i=1$ corresponds to $\mu$).

\subsubsection{Fick's law}
Fick's law for diffusion states that a gradient in $\phi$ will induce particles
to flow from the area of higher density to lower density along the gradient:
\begin{equation*}
  \vec{F}(\vec{x},t) = - D(\vec{x}) \grad \phi(\vec{x},t)\,.
\end{equation*}

The anisotropic diffusion tensor implies that a gradient in $\phi$ can induce
particle flow in a direction \emph{other than the direction of the gradient}. In
2-D, the anisotropic Fick's law looks like:
\begin{align*}
  \vec{F} &= - \Dtens \vd \grad \phi
  \\
  \begin{bmatrix}
    F^x \\
    F^y
  \end{bmatrix}
  &=
  -
  \begin{bmatrix}
    D^{xx} & D^{yx} \\
    D^{xy} & D^{yy}
  \end{bmatrix}
  \begin{bmatrix}
    \tpder \phi x \\
    \tpder \phi y
  \end{bmatrix} \,.
\end{align*}

If we calculate the ``leakage'' $\vec{n} \vd \vec{F}$ averaged over a planar
surface normal to $\vec{n}$, standard diffusion will only consider the gradient
\emph{normal} to the surface. For example, on a surface normal to the $x$ axis,
diffusion gives the leakage term
\begin{equation*}
  F^x = - D \pder{\phi}{x}\,.
\end{equation*}

However, anisotropic diffusion 
\begin{equation*}
  F^x = - D^{xx} \pder{\phi}{x} - D^{yx} \pder{\phi}{y}\,,
\end{equation*}
We refer to the leakage normal to the face, $- D^{xx} \pder{\phi}{x}$, as
``normal'' leakage; the leakage perpendicular to the face, $- D^{yx}
\pder{\phi}{y}$, we term the ``transverse'' leakage. As we will see in
chapter~\ref{chap:implementation}, the transverse leakage adds a layer of
complexity in anisotropic diffusion discretization schemes that is not present
in standard diffusion discretizations.

\subsubsection{Limited magnitude}
The standard diffusion coefficient is defined as
\begin{equation*}
  D(\vec{x}) = \frac{1}{3\sigma(\vec{x})} \,.
\end{equation*}
As $\sigma\to0$ locally, $D\to \infty$. An infinite diffusion coefficient in a
region gives a spatially constant $\phi$, which is virtually always an
unphysical solution.

In contrast to standard diffusion, the anisotropic diffusion approximation gives
a \emph{nonlocal} diffusion tensor. Since $f(\vec{x}, \vec{\Omega})$ remains
bounded, even when $\sigma=0$ at some point, $\Dtens$ will also remain bounded.

\subsubsection{Symmetric positive definiteness}
From Eq.~\eqref{eq:dij}, $\Dtens$ is clearly symmetric: $D^{ij}=D^{ji}$. Yet
$\Dtens$ is also symmetric positive definite (SPD), satisfying
\begin{equation*}
  \vec{a} \vd \Dtens \vd \vec{a} > 0
\end{equation*}
for all non-zero, real vectors $\vec{a}$ \cite{Tre1997}. To show this, we write 
\begin{align*}
  \vec{a} \vd \Dtens \vd \vec{a} &=
  \vec{a} \vd \left[\int_{4\pi} \vec{\Omega} \vec{\Omega}
  f(\vec{x}, \vec{\Omega}) \ud\Omega\right] \vd \vec{a}
  \\
  &=
  \int_{4\pi} (\vec{\Omega} \vd
  \vec{a}) (\vec{\Omega} \vd \vec{a})
  f(\vec{x}, \vec{\Omega}) \ud\Omega\,.
  \\
  &=
  \int_{4\pi} (\vec{\Omega} \vd \vec{a})^2
  f(\vec{x}, \vec{\Omega}) \ud\Omega\,.
\end{align*}
Because the solution for $f$ is strictly positive for all $\vec{\Omega}\in
4\pi$, and $(\vec{\Omega} \vd \vec{a})^2$ is positive for non-zero
$\vec{a}$, this integral will always be positive. Therefore, $\Dtens$ is SPD.

\subsubsection{Eigenvectors}
As stated in \S\ref{sec:determiningZeta}, if $f(\vec{\Omega})$ is azimuthally
symmetric about some unit vector $\vec{a}$, then $f$ is only a function of the
cosine angle
between $\vec{\Omega}$ and $\vec{a}$:
\begin{equation*}
f(\vec{\Omega}) = \hat f( \vec{\Omega} \vd \vec{a})\,.
\end{equation*}

If $\vec{a}$ is an eigenvector of $\Dtens$, then
\begin{equation*}
  \Dtens \vd \vec{a} = \lambda \vec{a}\,,
\end{equation*}
where $\lambda$ is a constant. Dotting Eq.~\eqref{eq:dDefinition} with
$\vec{a}$ and omitting the $\vec{x}$ parameter for brevity, we find
\begin{align*}
  \Dtens \vd \vec{a}
  &= \int_{4\pi} \vec{\Omega} \vec{\Omega} f(\vec{\Omega}) \ud\Omega \vd \vec{a}
  \\
  &= \int_{4\pi} (\vec{\Omega} \vd \vec{a}) \vec{\Omega} f(\vec{\Omega}) \ud\Omega
  \,.
\end{align*}
If $f$ is azimuthal about $\vec{a}$, then
\begin{align*}
  \Dtens \vd \vec{a}
  &= \int_{4\pi} (\vec{\Omega} \vd \vec{a}) \vec{\Omega}
    \hat f(\vec{\Omega} \vd \vec{a}) \ud\Omega \,.
\end{align*}
We change the angular coordinates so that $\vec{i}=\vec{a}$, which means
$\vec{\Omega} \vd \vec{a}=\mu$:
\begin{align*}
  \Dtens \vd \vec{a}
  &= \int_{0}^{2\pi} \int_{-1}^{1} (\mu)
  \left( \mu \vec{a} + \sqrt{1-\mu^2} \cos \theta \vec{u} + \sqrt{1-\mu^2} \sin
  \theta \vec{v} \right) \hat f(\mu) \ud\mu \ud\theta \,.
\end{align*}
Because $\hat f$ is not a function of $\theta$, the integrand is an
odd function of $\theta$, so the $\vec{u}$ and $\vec{v}$ components are zero.
\begin{align*}
  \Dtens \vd \vec{a}
  &= 2\pi \int_{-1}^{1} \mu^2 \hat f(\mu) \ud\mu \vec{a}
  \\
  &= \lambda \vec{a} \,.
\end{align*}
Thus, if $f$ is azimuthally symmetric about $\vec{a}$, $\vec{a}$ is an
eigenvector of $\Dtens$.
%This will prove a straightforward means of testing the
%assumption in \S\ref{sec:derBc} that, for both kinds of boundary conditions, $f$
%is approximately 

Because $\Dtens$ is SPD, its eigenvectors are orthogonal \cite[p.173]{Tre1997}.
This fact has a particularly important implication for a problem with symmetry.
If the opacity of the problem varies only along one particular direction
$\vec{a}$, then the
solution $f(\vec{x},\vec{\Omega})$ is only a function of $\vec{x}\vd \vec{a}$
and $\vec{\Omega} \vd \vec{a}$. Then, $\vec{a}$ is an eigenvector of $\Dtens$,
and the SPD property implies that vectors perpendicular to $\vec{a}$ are also
eigenvectors of $\Dtens$.

Thus, if $\sigma$ in a 3-D problem varies only along
the $x$ axis, then the vectors along \emph{each} axis are
eigenvectors of $\Dtens$: i.e., the diffusion tensor has only
components along the diagonal, and there is no transverse leakage on any
Cartesian face in the problem. For example, the 2-D VHTR problem in
\cite{Lar2009c} featured a total cross section that varied only along the $x$
axis. Therefore, even though the physical problem was a function of $(x,y)$
because of the isotropic source term, the diffusion tensor had
$D^{xy}=D^{yx}=0$, allowing the use of a very simple spatial discretization.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Properties of the anisotropic diffusion approximation}

The previous section showed that $\Dtens$ is SPD. Therefore, many reasonable
discretizations of the anisotropic diffusion equations will be SPD as well,
allowing
solution by the conjugate gradient (CG) method \cite{Tre1997}. This is in
contrast to quasidiffusion or Variable Eddington Factor methods which requires a
more computationally expensive solver such as GMRES \cite{War2003}.

Another property of the anisotropic diffusion approximation is that, like
standard diffusion, it is parabolic \cite{Pom1982,Ols2000}, allowing
radiation energy to propagate faster than the speed of light. The exact
intensity always satisfies the relation
\begin{align*}
  \norm{\vec{F}} &= \norm{ \int_{4\pi} \vec{\Omega}) I \ud \Omega}
  \\&\le \int_{4\pi} \norm{\vec{\Omega})} \abs{I} \ud \Omega 
  \\
  &\le \int_{4\pi} [1] I \ud\Omega
  \\
  \norm{\vec{F}} &\le \phi\,.
\end{align*}

Yet the new anisotropic Fick's law, Eq.~\eqref{eq:anisotropicFicks}, can violate
this relation:
\begin{equation*}
  \norm{\vec{F}} = \norm{\Dtens \vd \grad \phi}
\end{equation*}
if either $\Dtens$ or $\grad \phi$ is very large.

The anisotropic diffusion approximation for $\Psi$, as stated in
Eq.~\eqref{eq:approxPsi3},
\begin{equation*}
\Psi(\vec{x}, \vec{\Omega}, t) = - f(\vec{x}, \vec{\Omega})
\vec{\Omega}\vd \grad \phi(\vec{x}, t)\,,
\end{equation*}
is $O(\epsilon)$. The transport solution for $f$ is $O(1)$; it is roughly the
same magnitude as the opacity in the problem. $\grad \phi$ is $O(\epsilon)$.
Multiplying the equation by $\vec{\Omega}$ and integrating yields an $O(1)$
diffusion tensor and the $O(\epsilon)$ gradient, so $\vec{F}$ is $O(\epsilon)$
like the ansatz supposes.

Furthermore, because $f$ is continuous in space, the diffusion tensor is also
continuous. The solution for $\phi$ therefore has a smooth first
derivative, a fact that is compatible with the supposition that $\grad \phi$
is $O(\epsilon)$. This is also different from standard diffusion, which has
``kinks'' in $\phi$ at material interfaces, where $D$ is discontinuous.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Relating the $\Psi$ equations to diffusion}\label{sec:adDiscDiff}
Let us return to Eq.~\eqref{eq:capPsiVol}. Instead of using the integral
transport equation to derive the AD method, we could approximate $\Psi$
as a linear function in angle,
\begin{equation*}
  \Psi(\vec{x}, \vec{\Omega}, t) \approx \frac{3}{4\pi} \vec{\Omega} \vd
  \vec{F}(\vec{x}, t)\,,
\end{equation*}
which corresponds to the \Pone\ approximation $I= \frac{1}{4\pi} (\phi +
3\vec{\Omega} \vd \vec{F})$. It also satisfies the identities given in
Eqs.~\eqref{eqs:capPsiIdentities}: $\int_{4\pi} \Psi \ud\Omega = 0$ and
$\int_{4\pi} \vec{\Omega} \Psi \ud\Omega = \vec{F}$.

Substituting this approximation into the transport equation~\eqref{eq:capPsiVol}
for $\Psi$, we get
\begin{align*}
  \frac{1}{c} \pder{}{t} \left[ \frac{3}{4\pi} \vec{\Omega} \vd \vec{F} \right]
  + \vec{\Omega}\vd \grad \left[ \frac{3}{4\pi} \vec{\Omega} \vd \vec{F} \right]
  + \sigma^\ast \left[ \frac{3}{4\pi} \vec{\Omega} \vd \vec{F} \right]
  &= \frac{1}{4\pi} \grad \vd\vec{F}
  - \frac{1}{4\pi} \vec{\Omega}\vd \grad \phi\,.
\end{align*}
(The function arguments have been omitted for brevity.)
Taking the first moment of this equation and operating on it with $\int_{4\pi}
\vec{\Omega}(\cdot) \ud\Omega$ yields
\begin{multline*}
\frac{3}{4\pi} \left( \int_{4\pi} \vec{\Omega}\vec{\Omega}\ud\Omega \right) \vd
\frac{1}{c} \pder{}{t} \vec{F}
+ \frac{3}{4\pi} \left( \int_{4\pi}
  \vec{\Omega}\vec{\Omega}\vec{\Omega}\ud\Omega \right)
\vd \grad \vd \vec{F}
+ \frac{3}{4\pi} \left( \int_{4\pi} \vec{\Omega}\vec{\Omega}\ud\Omega \right)
\vd \sigma^\ast \vec{F}
\\
= \frac{1}{4\pi} \left( \int_{4\pi} \vec{\Omega}\ud\Omega \right)
\grad \vd\vec{F}
- \frac{1}{4\pi} \left( \int_{4\pi} \vec{\Omega}\vec{\Omega}\ud\Omega \right)
\vd \grad \phi\,.
\end{multline*}
Now, basic vector identities \cite{Lar2007} reduce the parenthesized
quantities to very manageable expressions: $\int_{4\pi}
\vec{\Omega}\vec{\Omega}\ud\Omega=\frac{4\pi}{3}\Identitytens$, and the odd
multiples of $\vec{\Omega}$ integrated over the unit sphere are zero. Thus,
\begin{equation*}
  \frac{1}{c} \pder{}{t} \vec{F}
  + \sigma^\ast \vec{F}
  =
  - \frac{1}{3} \grad \phi\,.
\end{equation*}
This is the standard \Pone{} equation, although it was formulated in an
admittedly unusual way.

Now if we neglect the time derivative of the radiation flux, making the
quasi-static approximation
\cite{Dud1976}, we recover Fick's law:
\begin{equation*}
\vec{F}(\vec{x}, t) = -\frac{1}{3\sigma^\ast(\vec{x})} \grad\phi(\vec{x}, t) \,.
\end{equation*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Summary}
The AD method approximates the transport equations~\eqref{eqs:fullTransport}
with a set of
low-order equations for the scalar intensity $\phi$ that use a diffusion
coefficient calculated from a simple high-order transport equation.
To derive the method, we:
\begin{enumerate}
  \item manipulated the radiation transport equation and conservation equation
    to get a differential transport equation for $\Psi$;
  \item separated $\Psi$ into an interior solution $\tilde \Psi$ and boundary
    layer solution $\Psi_\mathrm{bl}$;
  \item transformed the equation for $\tilde \Psi$ to an \emph{integral}
    transport equation;
  \item made assumptions about the strength of the solution's gradients and
    anisotropy;
  \item used Taylor series to approximate nonlocal unknowns with local
    unknowns and discarding small terms;
  \item applied a transport-matching procedure to $\Psi_\mathrm{bl}$ 
    and used the identity $\int_{4\pi} \Psi \ud\Omega=0$ to find boundary
    conditions for $f$ and $\phi$;
  \item took the first angular moment of $\tilde \Psi$ to get
    $\vec{F}=-\Dtens \vd \grad \phi$; and
  \item substituted $\vec{F}$ into the time-dependent particle conservation
    equation.
\end{enumerate}

The low order equation is the result of substituting the approximate Fick's law,
Eq.~\eqref{eq:anisotropicFicks} into Eq.~\eqref{eq:loVol}:
\begin{equation*}
\frac{1}{c} \pder{\phi}{t} (\vec{x}, t)
  - \grad \vd \Dtens(\vec{x}) \vd \grad \phi(\vec{x},t)
  + \sigma^\ast(\vec{x}) \phi(\vec{x}, t)
  = Q(\vec{x}, t) \,,
  \quad \vec{x} \in V,\ 0 \le t \le \Delta_t \,.
\end{equation*}
From Eq.~\eqref{eq:loInit}, it has an initial condition
\begin{equation*}
\phi(\vec{x}, 0) = \phi^i(\vec{x})\,, \vec{x} \in V  \,.
\end{equation*}
The incident source boundary condition with the simpler Marshak-like
approximation from Eq.~\eqref{eq:marshakAd} is
\begin{equation*}
  4 F^-(\vec{x}, t)
  = \phi(\vec{x}, t)
  + 2 \vec{n} \vd \Dtens(\vec{x}) \vd \grad \phi(\vec{x}, t) \,.
 \quad \vec{x} \in \partial V_b,\ 0 \le t \le \Delta_t \,.
\end{equation*}
The reflecting boundary condition from Eq.~\eqref{eq:reflLo2} is
\begin{equation*}
  \vec{n}\vd\grad \phi(\vec{x}, t) = 0 \,,
 \quad \vec{x} \in \partial V_r,\ 0 \le t \le \Delta_t \,.
\end{equation*}

The diffusion tensor is defined in Eq.~\eqref{eq:dDefinition},
\begin{equation*}
  \Dtens(\vec{x}) \equiv \int_{4\pi} \vec{\Omega} \vec{\Omega}
  f(\vec{x}, \vec{\Omega}) \ud\Omega \,,
\end{equation*}
where $f$ is the solution of a purely absorbing transport equation with an
isotropic source of unit strength and reflecting boundary conditions, as
described in Eqs.~\eqref{eq:fFullVol},~\eqref{eq:fFullBndy2},
and~\eqref{eq:fFullRefl}:
\begin{equation*}
    \vec{\Omega}\vd \grad f(\vec{x}, \vec{\Omega})
    + \sigma^\ast f (\vec{x}, \vec{\Omega})
  = \frac{1}{4\pi} \,, \quad x \in V,\ \vec{\Omega} \in 4\pi\,,
\end{equation*}
and
\begin{equation*}
  f(\vec{x}, \vec{\Omega}) = f(\vec{x}, \vec{\Omega}_r) \,,
 \quad \vec{x} \in \partial V, \ \vec{\Omega} \vd \vec{n} < 0\,.
\end{equation*}

These equations limit to the standard diffusion approximation in a homogeneous
medium, but they do not make the diffusion approximation that $I$ is linear in
angle. We therefore expect the AD method to give much more accurate answers
where $I$ is a complex function of angle.
Chapters~\ref{chap:simpleNumericalResults}
and~\ref{chap:trtNumericalResults} will put this expectation to the test.

