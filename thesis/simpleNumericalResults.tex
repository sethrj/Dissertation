% !TEX root = _individual/simpleNumericalResults.tex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Numerical Results: Test Problems}\label{chap:simpleNumericalResults}

The complexity of thermal radiative transport 
In solving the anisotropic diffusion equations, any number of choices in the
low-order discretization, the transport discretization, convergence criteria,
etc. There is correspondingly a real possibility that the cancellation of
errors may obscure the results of the TRT test problems. In this chapter we
systematically investigate the components of 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Discretization error}

In our numerical simulations, we must approximate the continuum transport
solutions with discrete methods. The low-order spatial discretization for the
tensor diffusion problems was formulated in Chapter~\ref{chap:implementation}.
For the high-order transport, we use diamond difference \cite{Lew1984} with a
``flux fix-up'' to ensure positivity.

\subsection{Diffusion spatial discretization: manufactured solutions}

\begin{figure}[htb]
  \centering\small
  \input{manufactured/convergence-multisolve-offdiag/plot}
  \caption[Solution error (absolute volume-weighted 2-norm) in the
  finite difference discretization schemes.]{Solution error (absolute
  volume-weighted 2-norm) in the finite difference discretization schemes. The
  slopes of $\Delta_x^{2}$, $\Delta_x^{1.5}$, and
  $\Delta_x$, respectively.}
  \label{fig:manuConvergence}
\end{figure}

\begin{figure}[htb]
  \centering
  \includegraphics{manufactured/offdiag-contours}
  \caption[Solution contours for the manufactured solutions test.]{
  Solution contours for the manufactured solutions test. The red dashed line is
  the Diagonal scheme, the blue dashed line is the Gol'din scheme, cyan and green
  are the nine-point schemes, and the thin black line is the analytic solution.}
  \label{fig:manuSolution}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Transport discretization: single steady-state channel}

The prototypical anisotropic diffusion test problem, a flatland VHTR mock-up due
to Larsen and Trahan \cite{Lar2009c}, consists of voided vertical channels in a
diffusive medium. The diffusive region has $\sigma_d=1$, the channel
$\sigma_c=0.01$. The scattering ratio is uniformly $0.99$.

We will use a small portion of this problem, a single channel of unit width,
with the 

The simplicity of this model allows for $f$ to be calculated analytically
rather than with an \SN\ transport solution. (Do I write the solution down
here?) We can therefore assess the penalty of various approximations against an
``exact'' solution.

Because the anisotropic diffusion coefficient can be calculated analytically,
the effect of using coarse-grid $\Dtens$ can be investigated independently of
the spatial discretization error accrued in an \SN\ solve.

%\begin{table}[htb]
%  \centering
%  \begin{tabular}{rll}
%    \\
%    $0 \le \omega < \frac{\pi}{2}$ &
%    $\sigma_d\inv + (\sigma_c \inv - \sigma_d\inv)
%    \left( 1 - \eexp^{ - \sigma_c (W + x) / \cos \omega} \right)
%    \frac{\pi}{2} < \omega < \pi &
%  \end{tabular}
%  \caption{<+Caption text+>}
%  \label{tab:<+label+>}
%\end{table}<++>

\begin{figure}[htb]
  \centering
  \includegraphics[width=3in]{ss_single_channel/xsn.png}
  \caption[Source and cross sections for the single channel problem.]%
  {Source and cross sections for the single channel problem. The colored region
  in the lower left is the Gaussian source.}
  \label{fig:ssSingleXsn}
\end{figure}

\begin{figure}[htb]
  \centering
  \includegraphics{ss_single_channel/phi.pdf}
  \caption[Contour plot of $\phi$ in the steady-state single channel
  problem.]{Contour plot of $\phi$ in the steady-state single channel problem.
  The dashed black line is the reference Monte Carlo solution; the dotted red
  line is standard diffusion; the broken black line is the anisotropic
  diffusion solution with analytic coefficients; the solid blue line is
  anisotropic diffusion with coefficients calculated with an S$_{32}$ transport
  sweep.}
  \label{fig:ssSingleContour}
\end{figure}

\begin{figure}[htb]
  \centering
  \input{ss_single_channel/phi-channel/plot}
  \caption{Scalar intensity along $x=5.0$.}
  \label{fig:ssSingleCenterline}
\end{figure}

Interestingly, the global norms have about the same error rate as the
channel-only. 

\begin{figure}[htb]
  \centering
  \input{ss_single_channel/absconv/plot}
  \caption{Convergence of the solution $\phi$ (volume-weighted 2-norm) with
  increasing iterations used for the AD coefficient solve, relative to $\phi$
  with analytic AD coefficients.}
  \label{fig:ssSingleMcconv}
\end{figure}

I also observed convergence as a function of the number of ordinates (using
Chebyshev equal-weight quadrature). The coarse-grid convergence was performed
with a diffusion grid of $\Delta_x = 1/32$.

\begin{figure}[htb]
  \centering
  \subfloat[Quadrature sets]{%
    \label{fig:ssSingleQsConv}
    \input{ss_single_channel/qsconv/plot}}%
  \subfloat[AD grid coarseness]{%
    \label{fig:ssSingleMgConv}
    \input{ss_single_channel/mgconv/plot}}%
  \caption{Error introduced by coarse spatial and angular grids in
  calculating the AD coefficients.}
  \label{fig:ssSingleConv}
\end{figure}

Realized last night that I didn't set the boundary conditions on the analytic
problem. \verb|:)| Plots have been updated accordingly. Quadrature set does
actually converge. Phew.

Figure~\ref{fig:ssSingleMgConv} is the steady-state channel problem with a
diffusive region width of 4.0 and a channel width of 1.0.

The rightmost data point in Fig.~\ref{fig:ssSingleMgConv} has a coarse cell
width of $\Delta_x=0.5$, half the width of the channel.

\begin{figure}[htb]
  \centering
  \subfloat[$D^{xx}$]{%
  \includegraphics[width=3in]{ss_single_channel/mg-dxx.png}}%
\subfloat[$D^{yy}$]{%
  \includegraphics[width=3in]{ss_single_channel/mg-dyy.png}}%
  \caption{Calculated diffusion coefficients for different grid coarseness.}
  \label{fig:ssSingleMgD}
\end{figure}

The differences calculated here are volume-weighted relative 2-norms:
\begin{equation}\label{eq:rel2norm}
  \text{reported difference} =
  \left[ \sum_{i \in \text{cells}} \left( 1 -
  \frac{\phi_i}{\phi_{i,\text{reference}}} \right)^2 (V_i)^2\right]^{1/2} \,.
\end{equation}
Compared to the reference solution, AD (with analytic coefficients) has a 4.5\%
absolute error and standard diffusion has a 19.8\% error.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\section{Flatland boundary conditions}

\begin{table}[htb]
  \centering
  \begin{tabular}{ccc}
\toprule
    Distribution & 1-D & Flatland
\\ \midrule
Isotropic & $I(\mu) = \frac{1}{2}$ & $I(\omega) = \frac{\pi}{2}$
\\
Normal & $I(\mu) = \delta(\mu-1)$ & $I(\omega) = \delta(\omega-\pi/2)$
\\
Grazing & $I(\mu) = \delta(\mu-0.1)$ & $I(\omega) = \delta(\omega-\sin\inv.1)$
\\ \bottomrule
  \end{tabular}
  \caption{Angular distributions used in boundary condition tests.}
  \label{tab:angularDistributions}
\end{table}

As a test problem, we consider a homogeneous flatland problem with a
total cross section $\sigma=1$ and scattering ratio $c=0.99$. It lives on the
domain $0 \le x \le 2$, $0 \le y \le 10$, with reflecting boundaries on the left,
right, and top sides. The bottom side has a specified boundary
condition with unit incident current, and we consider three different angular
distributions.

The first distribution is isotropic, $\psi^b(\omega) = \frac{1}{2}$. The second
is a normally incident flux, with all particles entering
perpendicular to the surface, $\psi^b(\omega) = \delta(\omega -
\frac{\pi}{2})$. The third incident distribution is at a grazing angle, with 
$\psi^b(\omega) = 10 \delta(\omega - \sin^{-1}.1)$.
These are the same angular distributions used in a boundary matching analysis
in \cite{Dav2006}.

Figure~\ref{fig:isotropic} shows a line-out of the scalar flux $\phi_0$ along
$x=1$ for an isotropic incident source. Because the left-hand sides of
Eqs.~\eqref{eq:flatMarshak} and~\eqref{eq:flatVarBc} are the same, the
differences in the solution are only due to the slightly different
extrapolation distance.

However, for the highly anisotropic normal and grazing cases,
Figs.~\ref{fig:delta} and~\ref{fig:grazing}, the Marshak boundary fails to
limit to the transport solution outside of the boundary layer. As
expected, the variational boundary condition does a much better job of
approximating the interior solution of the scalar flux.

\begin{figure}[htb!]
  \centering\small
  \hspace{-.5in}
  \input{flatlandbc-channel/isotropic-phi/plot}
  \hspace{-.5in}
  \caption{Scalar flux with an isotropic boundary condition in a homogeneous
  flatland problem.}
  \label{fig:isotropic}
\end{figure}

\begin{figure}[htb!]
  \centering\small
  \hspace{-.5in}
  \input{flatlandbc-channel/delta-phi/plot}
  \hspace{-.5in}
  \caption{Scalar flux with a normally incident boundary condition in a
  homogeneous flatland problem.}
  \label{fig:delta}
\end{figure}

\begin{figure}[htb!]
  \centering\small
  \hspace{-.5in}
  \input{flatlandbc-channel/grazing-phi/plot}
  \hspace{-.5in}
  \caption{Scalar flux with a grazing boundary condition in a homogeneous
  flatland problem.}
  \label{fig:grazing}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Anisotropic diffusion boundary conditions}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Steady-state flatland channel}
As a test problem, we consider a diffusive medium in flatland on
the domain $0
\le x \le 5$ and $0 \le y \le 10$, with a channel of unit width running
vertically through the middle. The diffusive region has $\sigma=1$ and
$\sigma_s=0.99$, and the channel has $\sigma=0.01$ and $\sigma_s=0.0099$. It has
reflecting boundaries on the top, left, and right sides, and an incident
boundary condition on the bottom. The geometry and cross sections are similar to Larsen
and Trahan's VHTR problem \cite{Lar2009c}.

We compare the AD method using three different boundary conditions for $f$ on
the bottom surface: a reflecting boundary, a white boundary, and a vacuum
boundary. The vacuum boundary is not consistent with our theory but
is shown to gauge how much $\phi$ is affected by the choice of $\zeta$.

Figure~\ref{fig:bcChannelIsotropic} shows a line-out of the scalar flux
$\phi(2.5,y)$, along the center
of the channel. Standard diffusion fails because $\sigma=0.01$ leads to a very
large diffusion coefficient, resulting in a nearly constant solution inside the
channel. Anisotropic diffusion performs exceedingly well, and curiously the
white boundary gives a better result than the reflecting boundary.

\begin{figure}[htb]
  \centering\small
  \hspace{-.5in}
  \input{adbc-channel/isotropic-phi/plot}
  \hspace{-.5in}
  \caption{Scalar flux along the centerline of the channel with an isotropic
  boundary condition at $y=0$.}
  \label{fig:bcChannelIsotropic}
\end{figure}

\begin{figure}[htb]
  \centering\small
  \hspace{-.5in}
  \input{adbc-channel/delta-phi/plot}
  \hspace{-.5in}
  \caption{Scalar flux along the centerline of the channel with a normal
  boundary condition at $y=0$.}
  \label{fig:bcChannelDelta}
\end{figure}

\begin{figure}[htb]
  \centering\small
  \hspace{-.5in}
  \input{adbc-channel/grazing-phi/plot}
  \hspace{-.5in}
  \caption{Scalar flux along the centerline of the channel with a grazing
  boundary condition at $y=0$.}
  \label{fig:bcChannelGrazing}
\end{figure}

A visualization of the angular flux for each method (replacing Monte Carlo with
an \SN\ solution), Fig.~\ref{fig:bcChannelIsotropicAngular}, helps explain the
accuracy
of the AD method and the difference between the reflecting and white boundary
treatments. Even though AD cannot exactly model the peak of freely streaming
photons in the channel (which the \SN\ angular flux shows at $\omega=3\pi/2$),
it accurately approximates the angular flux shape driven by scattering from the
diffusive region (the lobes on the left and right).
The linear-in-angle diffusion approximation cannot represent any of these
features.  

\begin{figure}[htb!]
  \centering\small
  \vspace{-.25in}
  \hspace{-.5in}
  \input{adbc-channel/angle-isotropic-cmfp/plot}
  \hspace{-.5in}
  \vspace{-.25in}
  \caption{Angular flux $\psi(2.5, 1., \omega)$ for the incident isotropic
  problem, in the centerline of the channel one unit from the boundary.}
  \label{fig:bcChannelIsotropicAngular}
\end{figure}

The shape around $\omega=\pi/2$ gives insight into why the white boundary
performs better in this problem: a reflecting boundary produces a peak in $f$
along the channel, but a white boundary gives a more isotropic shape near that
range, better matching the incident isotropic boundary condition. This suggests
that the qualitatively best way to satisfy Eq.~\eqref{eq:hoBc} may be
to have the incident distribution of $f$ take the shape of the true boundary
condition.


\begin{figure}[htb]
  \centering\small
  \subfloat[$\psi(2.5,0,\omega)$]{%
    \input{adbc-reactor/angle-center-y0/plot}}

  \hspace{-.75in}
  \subfloat[$\psi(2.5,10,\omega)$]{%
    \input{adbc-reactor/angle-center-ymax/plot}}%
  \hspace{-.5in}%
  \subfloat[$\psi(1.5,10,\omega)$]{%
    \input{adbc-reactor/angle-insideleftedge-ymax/plot}}%
  \hspace{-.75in}
  \caption{Angular flux in the channel at (a) the bottom center, (b) the top
  center, and (c) the top left edge.}
  \label{fig:bcReactor}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\subsection{Steady-state flatland checkers}
Not sure if this problem is useful or should be included.

Here we consider a difficult problem that has repeating variations in both $x$
and $y$ directions. It uses $c=0.99$, 

The anisotropic diffusion coefficients are plotted as ellipses in
Fig.~\ref{fig:bcCheckersAdcoeff}. The major axis is along the principal
eigenvector of the diffusion tensor and is in length proportional to the
principal eigenvalue; the more isotropic the tensor, the more circular the
glyph. Red and larger ellipses represent larger AD coefficients.

\begin{figure}[htb]
  \centering\small
  \includegraphics[width=3in]{adbc-checkers/adcoeff}
  \caption[Anisotropic diffusion coefficients for the checker problem.]{
  Anisotropic diffusion coefficients for the checker problem. Dark
  regions have $\sigma=1$, light regions have $\sigma=0.01$.}
  \label{fig:bcCheckersAdcoeff}
\end{figure}

\begin{figure}[htb]
  \centering\small
  \hspace{-.5in}
  \input{adbc-checkers/isotropic-phi/plot}
  \hspace{-.5in}
  \caption{Scalar flux along $x=2$ of the checker problem with an isotropic
  boundary condition at $y=0$.}
  \label{fig:bcCheckersIsotropic}
\end{figure}

\begin{figure}[htb]
  \centering\small
  \hspace{-.5in}
  \input{adbc-checkers/delta-phi/plot}
  \hspace{-.5in}
  \caption{Scalar flux along $x=2$ of the checker problem with a normal
  boundary condition at $y=0$.}
  \label{fig:bcCheckersDelta}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\section{Linear time-dependent behavior}

Before considering the complex nonlinear behavior of TRT, we should
independently analyze how the newly developed methods behave in linear,
time-dependent problems with time-independent opacities.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Reactor}

We consider a time-dependent problem represented in
Fig.~\ref{fig:tdReactorProblem}.
with a unit source in the bottom left corner of a diffusive medium of width
$2$ with $\sigma=1$ and a scattering ratio $c=.99$. A voided region with
$\sigma=0.01$ and $c=.99$ is to the right. The problem has reflecting boundaries
on the bottom, left, and right sides; the top has a vacuum boundary.

Figure~\ref{fig:tdReactorProblem} also displays the calculated coefficients
$\varsigma$ and $\Dtens$ used in the anisotropic \Pone\
equation~\eqref{eq:ap1FicksLawFinal}.

\begin{figure}[bp]
  \centering
  \includegraphics[width=2in]{td_reactor/xsn}
  \caption[Time-dependent reactor problem setup.]{Time-dependent reactor problem
    setup. The source region is the red square in the lower-left; the black
    and white area in the bottom half shows $\sigma$, the colored region above
    shows $\varsigma = 1/\int_{S} f \ud\Omega$, and the ellipses are a
    visualization of the diffusion tensor $\Dtens=\int_{S}
    \vec{\Omega}\vec{\Omega} f \ud\Omega$.}
  \label{fig:tdReactorProblem}
\end{figure}

\begin{figure}[htb]
  \centering\small
  \subfloat[$t=2$]{%
    \input{td_reactor/lineout-phi-channel-2/plot}}%
  \subfloat[$t=5$]{%
    \input{td_reactor/lineout-phi-channel-5/plot}}

  \subfloat[$t=10$]{%
    \input{td_reactor/lineout-phi-channel-10/plot}}%
  \subfloat[$t=15$]{%
    \input{td_reactor/lineout-phi-channel-15/plot}}

  \caption{Scalar intensity $\phi$ along the centerline of the channel.}
  \label{fig:tdReactor}
\end{figure}

The wavefront threshold in Fig.~\ref{fig:tdReactorWavefront} is 0.001.

\begin{figure}[htb]
  \centering\small
  \subfloat[Channel, $y=2.5$]{%
    \input{td_reactor/wavefront-phi-channel/plot}}

  \subfloat[Medium, $y=0$]{%
    \input{td_reactor/wavefront-phi-left/plot}}

  \caption{Wavefront position along the $y$ axis.}
  \label{fig:tdReactorWavefront}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\subsection{Blast wave}

Ran a test problem inside a channel with a ``blast wave'' initial condition. It
resides in $0 \le x \le 3$, $-1.1 \le y \le 1.1$, with a thin region inside
$-.1 \le y \le .1$. It has reflecting boundary conditions everywhere.

The initial condition is
\begin{equation*}
  \phi(x,y) = 0.001 + a \eexp^{-100 (x^2 + y^2) }
\end{equation*}
where $a$ is a normalization constant that gives a total initial $\int \phi
\ud V$ of $100 + 0.001 V$. We use $\sigma=1$ inside the channel, $\sigma=10$
outside, $c=0.99$ everywhere.

