% !TEX root = _individual/simpleNumericalResults.tex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Numerical Results: Test Problems}\label{chap:simpleNumericalResults}

When solving the anisotropic diffusion equations numerically, the solution
is not just a function of the physical problem: it is affected by the choice
of low-order discretization scheme, the transport discretization used in
calculating the AD coefficients, the transport convergence criteria, and many
other parameters. Furthermore, the added complexity of time dependence and
nonlinear opacities may obscure both the benefits and the shortcomings of the
anisotropic diffusion methods. Additionally, because of the novelty of the
flatland geometry, which we use extensively, it is necessary to provide numeric
validation for the flatland boundary conditions derived in
Chapter~\ref{chap:flatland}.

In this chapter, we systematically investigate certain attributes particular to
anisotropic diffusion (AD), flux-limited anisotropic diffusion (FLAD), and
anisotropic \Pone\ (\APone) by analyzing their behavior in simple steady-state
and time-dependent problems. Most of these problems emulate attributes of
realistic thermal radiative transfer problems, viz.~high scattering ratios and
optically thin regions surrounded by optically thick regions.

Our numerical simulations are executed with several existing methods as well
as the new anisotropic diffusion methods. All
are implemented in the \pytrt\ research code \cite{Pytrt}. Unless otherwise
noted, we use the following solver parameters with each method.
\begin{description}
  \item[The Monte Carlo method] functions as our benchmark transport method. Our
    implementation uses stratified sampling of source regions, and weight
    windows that attempt to keep uniform the weight of particles both emitted
    from sources and transported through previous time steps. The solver runs
    $10^7$ particles and uses path length--weighted tallies.

  \item[Standard diffusion] in our implementation uses a cell-centered
    discretization \cite{Dud1976}.  We use ``variational'' rather than the less
    accurate ``Marshak'' boundary conditions.
    As with the following diffusion-like methods, we explicitly
    construct a sparse matrix that is passed to the Trilinos library
    \cite{Her2003}.  In problems with fewer than 50,000 unknowns, we use the KLU
    direct solver. 

  \item[Time-dependent \Pone] uses the standard ``staggered mesh''
    discretization, where $\phi$ is cell-centered and $\vec{F}$ is
    face-centered.

  \item[Flux-limited diffusion] is implemented with the ``square root'' limiter
    and discretization scheme discussed in \S\ref{sec:bgFld}. The limiter is
    treated semi-implicitly; i.e., the nonlinear flux-limited diffusion
    coefficient is not converged. The unknowns and diffusion coefficients are
    stored on cell centers.

  \item[Anisotropic diffusion] uses
    coefficients calculated with the diamond difference \SN\ meth\-od, using 100
    sweep iterations. In flatland, we use a Chebyshev--Gauss quadrature set
    (see \S\ref{sec:flatlandQuadrature}) with 64 ordinates (S$_{32}$).
    %In 1-D, we use a Gauss--Legendre quadrature set with 16 ordinates
    %(S$_{16}$); 
    As with FLD, the opacities, diffusion coefficients, and unknowns are
    cell-centered. We use the nine-point stencil given in
    \S\ref{sec:cellAnisoA}. The low-order boundary conditions use the
    variational extrapolation distance 

  \item[Flux-limited anisotropic diffusion] is implemented with the
    ``max'' limiter described in \S\ref{sec:flad} using the flux limiter
    discretization of \S\ref{sec:bgFld}. It is otherwise treated identically to
    the above anisotropic diffusion method.

  \item[Anisotropic \Pone] uses the same ``staggered mesh'' discretization
    as \Pone, and in all other aspects it is identical to the other anisotropic
    methods.

\end{description}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Analysis of non-analytic AD coefficients}

In prior work, the anisotropic diffusion coefficients were calculated using
analytic solutions of $f$ \cite{Lar2009c}. However, in all but the simplest
problems, such solutions are impossible, so we use an \SN\ transport solver to
calculate the coefficients. Because \SN\ is only an approximation to the
transport equation, discretization in both the spatial and angular variables
will affect the calculated diffusion coefficients $\Dtens$, which in turn affect
the anisotropic diffusion solution $\phi$.

To assess the discrepancy in the solution incurred by using discrete transport,
we compare the solutions of a simple test problem using \SN-calculated
coefficients and analytically calculated coefficients.  We furthermore compare
the analytic and discrete solutions to a Monte Carlo reference solution, to see
if the discrepancy in the diffusion coefficients affects the accuracy of
the methods.

By varying the number of ordinates in the quadrature set, the spatial
refinement in the \SN\ calculation, the \SN\ convergence criteria, and the
choice of boundary conditions for the calculation of $f$ (reflecting or white),
we can determine acceptable solver parameters for later, more complex
problems.  A
voided channel surrounded by a diffusive, optically thick medium is
representative of many of our later test problems.

\subsection{Problem description}

The prototypical anisotropic diffusion test problem, a flatland VHTR mock-up
considered by Larsen and Trahan \cite{Lar2009c}, consists of voided vertical channels in a
diffusive medium. The diffusive region has $\sigma_d=1$, the channel
$\sigma_c=0.01$. The scattering ratio is uniformly $0.99$.  We will use a small
portion of this problem (Fig.~\ref{fig:ssSingleXsn}), a single channel of unit
width, with diffusive regions on the left and right each with width 4. The left
and lower boundaries are reflecting, and the right and upper boundaries are
vacuum. The source is a Gaussian function,
\begin{equation*}
  q(x,y) = 2 \eexp^{-2 (x^2 + y^2)}\,.
\end{equation*}

\begin{figure}[htb]
  \centering
  \includegraphics[width=3.5in]{ss_single_channel/xsn.png}
  \Caption{The single channel problem configuration.}{
  The total opacity is plotted in black and white, and the colored region in the
  lower left is the Gaussian source.}
  \label{fig:ssSingleXsn}
\end{figure}

The analytic solution for $f$ is based on the assumption that the channel is
infinite in extent along the $y$ axis, and that the diffusive regions are
infinitely wide. We therefore expect reflecting boundaries on the \SN\ transport
problem for $f$ to produce answers closer to the analytic values, but since the
channel is \emph{not} indeed infinite, reflecting boundaries will not
necessarily produce more accurate answers compared to the reference transport
solution. Using the analytic solution for $f$, we calculate exact solutions for
the anisotropic diffusion coefficient $\Dtens$ from
Eq.~\eqref{eq:flatDDefinition}
as well as boundary coefficient given in Eq.~\eqref{eq:flatAdBoundaryIntegral}:
\begin{equation*}
  \vec{d}(\vec{x}) = -4\int_{\vec{\Omega}\vd\vec{n} < 0}
  V(\abs{\vec{\Omega}\vd\vec{n}})
\vec{\Omega} f(\vec{x}, \vec{\Omega}) \ud\Omega\,.
\end{equation*}

All of the diffusion solutions, even though they may use analytically-calculated
coefficients, are solved using the standard five-point cell-centered diffusion
scheme%
\footnote{%
Because the opacity is symmetric about the $x$ axis, $D^{xy}=0$
throughout the problem; see \S\ref{sec:adLinalg}.
} using a uniform cell width of 0.0625.

\subsection{Solution}
The solution of the problem using four different methods is plotted in
Fig.~\ref{fig:ssSingleContour}. The Monte Carlo solution is the reference
solution.  We have also shown the anisotropic diffusion solutions with
both analytically calculated coefficients and \SN-calculated coefficients. The
latter uses reflecting boundaries on the transport calculation for $f$ with
$10^4$ source iterations. For comparative purposes, we also plot the standard
diffusion solution.

Before exploring the parameter space of \SN\ solver options, we first point out
some features in the solution characteristic of anisotropic diffusion. Unlike
the Monte Carlo and diffusion solutions, which have discontinuities at the
boundary between channel and medium, the anisotropic diffusion solution is
smooth. The AD solution is less accurate near the material boundaries, but along
the centerline of the channel (Fig.~\ref{fig:ssSingleCenterline}) and a few mean
free paths into the medium, it matches the reference solution very closely.

\begin{figure}[htb]
  \centering
  \includegraphics{ss_single_channel/phi.pdf}
  \Caption{ Contour plot of $\phi$ in the steady-state single channel problem.}{
  The dashed black line is the reference Monte Carlo solution; the dotted red
  line is standard diffusion; the broken black line is the anisotropic
  diffusion solution with analytic coefficients; the solid blue line is
  anisotropic diffusion with coefficients calculated with an S$_{32}$ transport
  sweep.}
  \label{fig:ssSingleContour}
\end{figure}

\begin{figure}[htb]
  \centering
  \input{ss_single_channel/phi-channel/plot}
  \Caption{Scalar intensity along $x=5.0$.}{
    The ``AD'' curve is the solution using analytic diffusion coefficients;
  the ``AD$_N$'' curves use S$_N$-calculated coefficients.}
  \label{fig:ssSingleCenterline}
\end{figure}

\subsection{\texorpdfstring{\SN}{SN} parameter convergence}
Figure~\ref{fig:ssSingleAbsConv} plots the convergence of the solution $\phi$
against the solution with analytically-calculated AD coefficients, for four
different combinations of \SN\ solver parameters, as a function of the number of
source iterations (transport sweeps) in the calculation of $f$.

Likewise, figure~\ref{fig:ssSingleQsConv} plots the convergence of the \SN\ 
solution with increasing number of ordinates. The black line shows that refining
the quadrature brings the solution closer to the analytic value, but the red
line demonstrates that it does \emph{not} converge to the Monte Carlo transport
solution. This is expected: anisotropic diffusion contains several
approximations that are non-negligible in this problem. As with diffusion, we
run problems far outside its theoretical (asymptotic) range of applicability.
Unlike diffusion, anisotropic diffusion yields reasonable answers in the
presence of voids.

\begin{figure}[htb]
  \centering
  \subfloat[Source iterations]{%
    \label{fig:ssSingleAbsConv}
    \input{ss_single_channel/absconv/plot}}%
  \subfloat[Quadrature sets]{%
    \label{fig:ssSingleQsConv}
    \input{ss_single_channel/qsconv/plot}}%
  \Caption{Convergence of $\phi$ as a function of \SN\ parameters.}{
    The AD solution $\phi$ with \SN-calculated coefficients is compared
    against the solution with analytic coefficients using a volume-weighted
    2-norm, as a function of increasing source iterations in the calculation of
    $f$. The red line in (b) shows convergence compared to the Monte Carlo
    solution.}
  \label{fig:ssSingleConv}
\end{figure}

The convergence is calculated using a volume-weighted relative 2-norm:
\begin{equation}\label{eq:rel2norm}
  \text{reported difference} =
  \left[ \sum_{i \in \text{cells}} \left(
  \frac{\phi_i}{\phi_{i,\text{reference}}} - 1 \right)^2 (V_i)^2\right]^{1/2} \,.
\end{equation}
This is \emph{not} the convergence of the transport solution $f$, which only
indirectly affects the $\phi$.
Compared to the reference solution, AD (with analytic coefficients) has a 4.5\%
absolute error and standard diffusion has a 19.8\% error.

The data in Fig.~\ref{fig:ssSingleAbsConv} suggest that with a finite number of
ordinates, which cannot exactly
approximate the angular domain, there is little added benefit to using more than
a few sweeps: the error introduced by the angular approximation overwhelms
the lack of convergence. But Fig.~\ref{fig:ssSingleQsConv} shows that, since
even the analytic AD solution differs from the exact solution by ~5\%, even a
coarse quadrature set can provide accuracy within the inherent limits of the
method.
%Additionally, the choice of reflecting or white boundary conditions has
%little effect on the solution of this problem.

This conclusion may not hold for some problems, of course, but it suggests that
a modest number of ordinates and sweeps are sufficient to yield answers with
close to the accuracy of an analytic anisotropic diffusion solution.

\clearpage
\subsubsection{Coarse spatial grid calculation of \texorpdfstring{$\Dtens$}{D}}

In addition to investigating how the AD solution changes with the granularity of
the angular variable in the solution of $f$, we test the discrepancy
introduced by calculating $f$ on a coarser spatial grid. As discussed in
\S\ref{sec:adSmoothness}, the solution of $f$ is a smooth function of space, and
$\Dtens$ likewise has no discontinuities. We have implemented the basic
multigrid operations of prolongation and restriction in the \pytrt\ code
for cell-centered quantities and quantities on the boundary face \cite{Pytrt}.

%The total opacity is restricted using a volume-weighted harmonic average 
We run the transport calculation for $f$ on a coarse grid and prolongate the
diffusion tensor $\Dtens$ and boundary coefficient $\vec{d}$ back to the fine
grid, in which $\phi$
is then solved. With this methodology, the spatial discretization error of the
diffusion solve is unaffected; the only difference is that the diffusion
coefficients are a coarser function of space. Figure~\ref{fig:ssSingleMgD} shows
the resulting coarse anisotropic diffusion coefficients.

\begin{figure}[htb]
  \centering
\subfloat[$D^{xx}$]{%
  \includegraphics[width=3in]{ss_single_channel/mg-dxx.png}}%
\subfloat[$D^{yy}$]{%
  \includegraphics[width=3in]{ss_single_channel/mg-dyy.png}}%
  \Caption{Calculated diffusion coefficients for different grid coarseness.}{
  Every two units downward represents a factor of four refinement in the
  number of fine cells per coarse cell.}
  \label{fig:ssSingleMgD}
\end{figure}

Figure~\ref{fig:ssSingleMgConv} plots the error in $\phi$ introduced by using
coarse approximations to the anisotropic diffusion coefficient. (In this
problem, the grid and refinements were chosen so that in the coarsest case, each
coarse cell was composed of a single material.) 
The rightmost data point in the figure has a coarse cell width of
$\Delta_x=0.5$, half the width of the channel.
\begin{figure}[htb]
  \centering
  \input{ss_single_channel/mgconv/plot}
  \caption{Error introduced by coarse spatial grids in calculating the AD
  coefficients.}
  \label{fig:ssSingleMgConv}
\end{figure}
Clearly, in this simple problem with well-defined material boundaries, the
solution is relatively insensitive to using less spatially refined diffusion
coefficients. This is perhaps not surprising, as, for example, the standard
diffusion coefficient has no spatial variation inside a homogeneous material.

The implication of all these results is clear: high-fidelity transport
calculations are \emph{not} needed in calculation of the anisotropic diffusion
coefficients. Because the cost of the transport calculation is
roughly proportional to $
  (\text{the number of transport sweeps}) \times 
  (\text{the number of ordinates}) \times 
  (\text{the number of spatial cells})$,
using only a modest number of sweeps and a small quadrature set with a
coarse-grid calculation can provide a substantial speedup when compared with a
fine-grid calculation that might improve the answer only by a tenth of a
percent. Because we do not expect the anisotropic diffusion approximation to
yield exact transport solutions, and because a high-fidelity transport
calculation requires far more computational effort than a diffusion solve, the
small error incurred by using a coarse transport solution is justifiable in
light of the performance gain.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Flatland boundary conditions}

The flatland boundary conditions derived in Chapter~\ref{chap:flatland} must,
for the sake of completeness, be numerically verified. We compare the novel
diffusion boundary conditions against a Monte Carlo reference solution in a
simple, diffusive test problem.

We consider a homogeneous flatland problem with a
total cross section $\sigma=1$ and scattering ratio $c=0.99$. The spatial 
domain is the rectangle $0 \le x \le 2$, $0 \le y \le 10$, with
reflecting boundaries on the left,
right, and top sides. The bottom side has a specified unit incident radiation
flux; we consider three different angular
distributions given in Table~\ref{tab:angularDistributions}.\footnote{These
distributions were chosen because of their prior use in a 1-D boundary
matching analysis in \cite{Dav2006}.}

\begin{table}[htb]
  \centering
  \begin{tabular}{ccc}
\toprule
    Distribution & 1-D & Flatland
\\ \midrule
Isotropic & $I(\mu) = \frac{1}{2}$ & $I(\omega) = \frac{\pi}{2}$
\\
Normal & $I(\mu) = \delta(\mu-1)$ & $I(\omega) = \delta(\omega-\pi/2)$
\\
Grazing & $I(\mu) = \delta(\mu-0.1)$ & $I(\omega) = \delta(\omega-\sin\inv.1)$
\\ \bottomrule
  \end{tabular}
  \caption{Angular distributions used in boundary condition tests.}
  \label{tab:angularDistributions}
\end{table}

Figure~\ref{fig:flatlandBcDelta},
 a line-out of the scalar flux $\phi_0$ along
$x=1$ for the normally incident boundary, illustrates the differences between
the methods. The diffusion
approximation cannot reproduce the boundary layer that the true transport
solution features, but the variational approximation to the flatland
diffusion boundary condition allows the asymptotic diffusion solution to
closely match the transport solution. The Marshak boundary does not.

Figure~\ref{fig:flatlandBcRelative} quantitatively compares both ``variational'' and
``Marshak'' diffusion boundary conditions against the transport solution
for all three incident distributions.  
As with the variational boundary condition for 3-D geometry, the flatland
variational boundary condition gives an interior scalar flux accurate to within
a few percent. The Marshak condition fails to limit to the transport solution except in
the case of an isotropic boundary source, for which only the extrapolation
distance differs from the variational boundary condition.

\begin{figure}[tb]
  \centering\small
  \hspace{-.25in}%
  \input{flatlandbc-channel/delta-phi/plot}
  \caption{Scalar flux with a normally incident boundary condition in a
  homogeneous flatland problem.}
  \label{fig:flatlandBcDelta}
\end{figure}
 
\begin{figure}[tb]
  \centering\small
  \hspace{-.25in}%
  \input{flatlandbc-channel/relative-errors/plot}
  \caption{Relative errors ($\phi/\phi_\text{MC} - 1$) of the three tested
  distributions.}
  \label{fig:flatlandBcRelative}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Anisotropic diffusion boundary conditions}

In Chapter~\ref{chap:adDerivation}, we derived boundary conditions for the
anisotropic diffusion approximation. These boundary conditions reduce to the
standard diffusion boundary condition in a homogeneous medium, but they were
derived under a different set of asymptotic assumptions. We test the extent of
their applicability using several steady-state flatland test problem similar to
the above.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Interior source}

The first test of the anisotropic diffusion boundary conditions is a highly
scattering problem with a spatially smooth source in the interior. A vacuum
boundary in the problem serves as the primary sink for particles in the
problem; we therefore expect the global solution to be sensitive to the choice
of boundary conditions.

\subsubsection{Problem description}

The test problem (Fig.~\ref{fig:bcReactorProblem}) is similar to the above
flatland boundary condition test
problem. It features a diffusive medium in flatland on the domain $0
\le x \le 5$ and $0 \le y \le 10$, with a channel of unit width running
vertically through the middle ($2.5 \le x \le 3.5$). The diffusive region has
$\sigma=1$ and $\sigma_s=0.99$, and the channel has $\sigma=0.01$ and
$\sigma_s=0.0099$.
The problem has reflecting boundaries on the top, left, and
right sides, and an incident boundary condition on the bottom with unit
incident radiation flux. We consider the same angular distributions as in

\begin{figure}[htb]
  \centering
  \includegraphics[width=2in]{adbc-reactor/xsn}

  \Caption{Steady-state AD boundary condition test problem.}{
    The black region is diffusive ($\sigma=1$, $\sigma_s=0.99$), the white
    region is optically thin ($\sigma=0.01$, $\sigma_s=0.0099$). The colored
    region in the lower-left is the Gaussian source.}
  \label{fig:bcReactorProblem}
\end{figure}

The problem has the same physical description as the previous: two diffusive
regions surround an optically thin channel.
The boundary conditions are
different, however: the bottom is reflecting, and the top is a vacuum. 
The source is an isotropic Gaussian-shaped radiation source in the lower-left
corner:
\begin{equation*}
  q(x,y) = 2 \eexp^{-2 (x^2 + y^2) } \,.
\end{equation*}
The grid width used is $\Delta_x = \Delta_y = 0.1$.

We compare a Monte Carlo solution, a diffusion solution, and three instances of
anisotropic diffusion with different choices for the boundary condition on the
vacuum boundary. Only two---the white and reflecting
conditions---satisfy Eq.~\eqref{eq:hoBc}. The ``na\"ive'' boundary condition
sets the incident values of $f$ to zero.

\subsubsection{Results and discussion}

To begin, we plot $f$ (Fig.~\ref{fig:bcReactorF}) at the top of the problem for
the three alternative boundary conditions for the purely absorbing transport
problem.

\begin{figure}[tb]
  \centering
  \subfloat[$f(2.5,10,\omega)$]{%
    \hspace{-.25in}%
    \input{adbc-reactor/adf-center-ymax/plot}%
   \label{fig:bcReactorFchan}%
  }%
  \subfloat[$f(1.5,10,\omega)$]{%
    \hspace{-.25in}%
    \input{adbc-reactor/adf-insideleftedge-ymax/plot}
  }%
  \Caption{Plots of the purely absorbing transport solution at two points in
  at the end of the channel.}{
  The center of the channel (a) shows the highly anisotropic behavior $f$ can
  take; further from material discontinuities (b), $f$ tends toward isotropy.
  }
  \label{fig:bcReactorF}
\end{figure}

The boundary condition's effect on $f$ is straightforward: a reflecting boundary
condition mirrors the angular distribution across the $x$ axis, and a white
boundary condition yields an isotropic distribution for incident angles. The
na\"ive boundary condition is positive only for exiting angles. For the sake of
comparison, the diffusion approximation $f(\vec{x},\vec{\Omega}) =
\frac{1}{2\pi \sigma(\vec{x})}$ could be plotted as a circle. (In
Fig.~\ref{fig:bcReactorFchan}, it would be out of range of the plot.) Both the
anisotropic diffusion tensor $\Dtens$ and the boundary coefficient
$\vec{d}$ change as a result of the boundary conditions.

The different diffusion and boundary coefficients naturally cause the
anisotropic diffusion solutions $\phi$ to differ. Figure~\ref{fig:bcReactorFlux}
compares the three instances of anisotropic diffusion with the Monte Carlo
reference solution and the diffusion solution.

\begin{figure}[htb]
  \centering
  \hspace{-.25in}%
  \input{adbc-reactor/phi-channel/plot}
  \caption{Scalar flux in the steady-state interior source problem.}
  \label{fig:bcReactorFlux}
\end{figure}

Clearly, anisotropic diffusion is superior to conventional diffusion: it differs
from the reference solution by only few percent globally. The two choices of
boundary conditions for $f$ consistent with Eq.~\eqref{eq:hoBc}, reflecting and
white, produce very similar answers. In contrast, the inconsistent choice of a
vacuum boundary for $f$ introduces a significant global error, even many mean
free paths away from the boundary.

To help understand the accuracy of anisotropic diffusion as compared to standard
diffusion, we have plotted in Fig.~\ref{fig:bcReactorAngular} the angular
intensity at several points in the problem as approximated by \SN, AD, and
standard diffusion. Whereas diffusion approximates the radiation as linear in
angle, anisotropic diffusion has much more \emph{shape} that results from the
anisotropy in $f$. As we asserted in Chapter~\ref{chap:adDerivation}, this extra
transport-derived information results in a more accurate answer.

\begin{figure}[htb]
  \centering\small
  \subfloat[$\psi(2.5,0,\omega)$]{%
    \hspace{-.25in}%
    \input{adbc-reactor/angle-center-y0/plot}}

  \subfloat[$\psi(2.5,10,\omega)$]{%
    \hspace{-.25in}%
    \input{adbc-reactor/angle-center-ymax/plot}}%
  \subfloat[$\psi(1.55,5,\omega)$]{%
    \hspace{-.25in}%
    \input{adbc-reactor/angle-insideleftedge-y5/plot}}%
  \caption{Angular flux in the channel at (a) the bottom center, (b) the top
  center, and (c) the middle left edge.}
  \label{fig:bcReactorAngular}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\subsection{Boundary source}

The problems with an incident particle flux on the boundary potentially have
strong gradients and anisotropy outside the applicable range of the anisotropic
diffusion approximation. As an alternative test of the boundary conditions, we
consider three boundary source--driven problems.

\subsubsection{Problem description}

This test problem has opacities identical to the previous: two diffusive
regions surround an optically thin channel. However, rather than being driven
by an extraneous source, the problem has an incident radiation flux on the
bottom face. The top, left, and right sides are reflecting. We consider the same
angular distributions as in Table~\ref{tab:angularDistributions}: an isotropic
source, a normally-incident source, and a grazing source.

\subsubsection{Results and Discussion}

Figure~\ref{fig:adbcIsotropic} shows a line-out of the scalar flux $\phi(2.5,y)$
along the center of the channel in the isotropic incident case. Standard
diffusion fails because $\sigma=0.01$ leads to a very
large diffusion coefficient, resulting in a nearly constant solution inside the
channel. Anisotropic diffusion performs exceedingly well, and the
white boundary condition for $f$ gives a better result than the reflecting
boundary condition.

\begin{figure}[htb]
  \centering
  \centering\small
  \hspace{-.25in}%
  \input{adbc-channel/isotropic-phi-channel/plot}
  \caption{Scalar flux along the centerline of the channel with an isotropic
  boundary condition at $y=0$.}
  \label{fig:adbcIsotropic}
\end{figure}

The AD approximation and its boundary conditions do have their limits. In the
case of a strongly anisotropic boundary source, the ansatz that
$\vec{F} = O(\epsilon)$ is violated in swaths of the problem, so the solutions
for the normal and grazing boundary conditions have large errors
(Fig.~\ref{fig:adbcRelErr}).

\begin{figure}[htb]
  \centering
  \centering\small
  \hspace{-.25in}%
  \input{adbc-channel/relative-errors/plot}
  \caption{Relative errors along the centerline of the channel with the three
  different incident boundary conditions.}
  \label{fig:adbcRelErr}
\end{figure}

A visualization of the angular flux for each method (replacing Monte Carlo with
an \SN\ solution), Fig.~\ref{fig:bcChannelIsotropicAngular}, helps explain the
accuracy
of the AD method and the difference between the reflecting and white boundary
treatments. Even though AD cannot exactly model the peak of freely streaming
photons in the channel (which the \SN\ angular flux shows at $\omega=3\pi/2$),
it accurately approximates the angular flux shape driven by scattering from the
diffusive region (the lobes on the left and right) in the isotropic incident
case. In the strongly anisotropic (normal incident source) case, where
uncollided particles from the boundary dominate the scattered particles,
anisotropic diffusion is unable to accurately approximate the particle
distribution in the channel.
The linear-in-angle diffusion approximation cannot represent any of these
features.

\begin{figure}[htb]
  \centering\small
  \subfloat[Isotropic]{%
  \input{adbc-channel/angle-isotropic-center-y1/plot}%
  \vspace{-.25in}%
  }%
  \subfloat[Normal]{%
  \input{adbc-channel/angle-delta-center-y1/plot}%
  \vspace{-.25in}%
  }%
  \Caption{Angular flux $\psi(2.5, 1, \omega)$ in the incident boundary source
  problem.}{
  The isotropic (a) and normal (b) incident cases are plotted in the centerline
  of the channel, one unit from the boundary.}
  \label{fig:bcChannelIsotropicAngular}
\end{figure}

The shape around $\omega=\pi/2$ gives insight into why the white boundary
performs slightly better in the case of an isotropic incident boundary
condition: a reflecting boundary produces a peak in $f$
along the channel, but a white boundary gives a more isotropic shape near that
range, better matching the incident isotropic boundary condition. This suggests
that the qualitatively best way to satisfy Eq.~\eqref{eq:hoBc} may be
to have the incident distribution of $f$ take the shape of the true boundary
condition.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\section{Linear time-dependent behavior}

One novel extension to the anisotropic diffusion approximation is the
formulation for time-dependent transport. Even though our primary application is
the time-dependent nonlinear thermal radiative transfer, we stress that the
nonlinearities are completely incidental to the AD approximation. We therefore 
test the behavior of the anisotropic diffusion methods in a more simple
situation: linear, time-dependent problems with no material
coupling and time-independent opacities.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Smooth linear problem}

We devised a time-dependent problem where the temporal and spatial gradients are
expected to be moderate but significant enough to distinguish diffusion from
transport.

\subsubsection{Problem description}

This smooth problem features a unit source in the bottom left corner of a
diffusive medium of width~$2$ with
$\sigma=1$ and a scattering ratio~$c=.99$. A voided region with width $0.5$,
$\sigma=0.01$, and $c=.99$ lies along the right edge of the problem. The bottom,
left, and right boundaries are reflecting; the top of the problem has a vacuum
boundary. Its initial condition is uniformly zero.

Because this problem is time-dependent, it is the first test of the anisotropic
\Pone\ method devised in Chapter~\ref{chap:aponeDerivation}. This method
uses not only the anisotropic diffusion tensors $\Dtens$ but also a nonlocal
opacity $\varsigma$, as formulated in \eqref{eq:ap1FicksLawFinal}:
\begin{equation*}
  \frac{1}{c}\pder{\vec{F}}{t}(\vec{x},t)
  + \varsigma(\vec{x}) \Dtens(\vec{x}) \vd \grad \phi(\vec{x}, t)
  + \varsigma(\vec{x})\vec{F}(\vec{x},t) 
  = 0 \,.
\end{equation*}
Figure~\ref{fig:tdReactorProblem} overlays these transport-calculated
coefficients on the problem's physical description.

\begin{figure}[bp]
  \centering
  \includegraphics[width=2in]{td_reactor/xsn}
  \Caption{Time-dependent smooth problem setup.}{
    The source region is the red square in the lower-left; the black
    and white area in the bottom half shows $\sigma$, the colored region above
    shows $\varsigma = 1/\int_{S} f \ud\Omega$, and the ellipses are a
    visualization of the diffusion tensor $\Dtens=\int_{S}
    \vec{\Omega}\vec{\Omega} f \ud\Omega$.}
  \label{fig:tdReactorProblem}
\end{figure}

In this figure, the anisotropic diffusion tensors are plotted as ellipses. Each
ellipse's major axis
lies along the principal eigenvector of $\Dtens$, and the size along that axis is
proportional to the corresponding eigenvalue. The minor axis is proportional to
the second eigenvalue of the tensor. If $f$ is isotropic, $\Dtens$ is
proportional to the identity tensor, and its two eigenvalues are equal: thus, in
the interior, the anisotropic diffusion coefficients appear as circles whose
sizes are proportional to $1/\sigma$.

\subsubsection{Results and Discussion}

The large phase space of time-dependent transport forces us to carefully choose
representative metrics. We use contour plots to compare select methods at
select times, lineouts to compare more methods in greater detail, and wavefront
plots to visualize the detailed time evolution of the problem.

The behavior of $\phi$ along the center of the channel (i.e., at the
right edge of the problem) is plotted in Fig.~\ref{fig:tdReactor}. Anisotropic
diffusion and conventional diffusion, which both assume a quasi-static problem,
are significantly less accurate and are not plotted in that figure. Their
flux-limited counterparts, FLAD and FLD, are shown instead.

\begin{figure}[htb]
  \centering\small
  \subfloat[$t=2$]{%
    \hspace{-.25in}%
    \input{td_reactor/lineout-phi-channel-2/plot}}%
  \subfloat[$t=5$]{%
    \hspace{-.25in}%
    \input{td_reactor/lineout-phi-channel-5/plot}}

  \subfloat[$t=10$]{%
    \hspace{-.25in}%
    \input{td_reactor/lineout-phi-channel-10/plot}}%
  \subfloat[$t=15$]{%
    \hspace{-.25in}%
    \input{td_reactor/lineout-phi-channel-15/plot}}

  \caption{Scalar intensity $\phi$ along the centerline of the channel, $y=2.5$.}
  \label{fig:tdReactor}
\end{figure}

None of the low-order methods yields the transport solution. Even with flux
limiting, FLD and FLAD overestimate the rate of particles flowing into the void.
As the problem tends toward steady-state, the anisotropic
methods become relatively accurate. (We recall that both FLAD and \APone\ limit
to the AD method when the solution varies slowly in time.)

A contour plot showing the difference between \Pone\ and \APone\ is given in
Fig.~\ref{fig:tdReactorContour}. The \APone\ solution is generally more accurate
than \Pone. As the system evolves in time, it becomes like the steady-state
channel problems analyzed earlier: diffusion (the steady-state limit of \Pone)
fails in these problems, so it is unsurprising that \APone\ outperforms \Pone\
at late times.

\begin{figure}[htb]
  \centering\small
  \subfloat[$t=2$]{%
    \includegraphics{td_reactor/phi-002}}%
  \subfloat[$t=5$]{%
    \includegraphics{td_reactor/phi-005}}

  \subfloat[$t=10$]{%
    \includegraphics{td_reactor/phi-010}}%
  \subfloat[$t=15$]{%
    \includegraphics{td_reactor/phi-015}}

  \Caption{Contour plots of the scalar intensity at four times.}{
    The black dashed line is the Monte Carlo solution, the blue solid line is
    the \APone\ solution, and the red dotted line is the \Pone\ solution.}
  \label{fig:tdReactorContour}
\end{figure}

As a final diagnostic, we plot the ``wavefront'' positions---determined by the
location at which $\phi=0.001$ after applying a small amount of smoothing---for
all of the methods in Fig.~\ref{fig:tdReactorWavefront}. These plots again show
how FLAD and AD both overestimate the scalar flux at early times, and they also
point to an explanation. Because the flux limiters are not iterated upon, the
solution of the first time step is the same as the standard diffusion
solution. (In Fig.~\ref{fig:tdReactorWavefrontLeft}, the flux-limited and
standard diffusion methods share a starting point.) As a result, the
flux-limited methods carry that artifact of non-flux-limited particles for all
later time steps. To obviate this error, shorter initial time steps (where
the effective time absorption $1/c\Delta_t$ reduces the magnitude of the
precursor) could be used, or the nonlinear flux-limited diffusion coefficient
could be converged.

\begin{figure}[htb]
  \centering\small
  \hspace{.25in}%
  \subfloat[Channel, $x=2.5$]{%
    \hspace{-.25in}%
    \input{td_reactor/wavefront-phi-channel/plot}}
  \subfloat[Medium, $x=0$]{%
    \label{fig:tdReactorWavefrontLeft}%
    \hspace{-.25in}%
    \input{td_reactor/wavefront-phi-left/plot}}
  \caption{Wavefront position along the $y$ axis.}
  \label{fig:tdReactorWavefront}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\subsection{Blast wave}

Thermal radiative transfer problems often contain strong spatial and temporal
gradients. We consider a more stressful test of the different anisotropic
approximations to the transport equation.

\subsubsection{Problem description}

The ``blast wave'' test problem features a localized impulse of radiation; the
magnitude of the coefficients is based on a recurrent test problem in the field
of thermal radiative transfer \cite{Kno1999a,Kno2001,Rau2005,Ols2007}. The
domain of this problem is $0 \le x \le 3$ and $-1.1 \le y \le 1.1$.
It features an optically thin channel with $\sigma=1$ and $\sigma_s=0.99$ inside
$-.1 \le y \le .1$, with a diffusive region $\sigma=10$ and $\sigma_s=9.99$
outside it. All boundaries are specularly reflecting.

The initial condition is a local but smooth Gaussian function:
\begin{equation*}
  \phi(x,y) = 0.001 + 100 \eexp^{-100 (x^2 + y^2) }\,.
\end{equation*}
We use a grid spacing of $\Delta_x=\Delta_y=0.02$, and a uniform time step
$\Delta_t=0.02$.

\subsubsection{Results and Discussion}

The final state ($t=3$) of the problem is plotted in Fig.~\ref{fig:tdBlastwave}.
Several features characteristic of the methods are apparent. First, only the
transport solution (Monte Carlo) contains the peak of uncollided particles at
$x=3$. Aside from that peak, the particles that have undergone
multiple collisions, the anisotropic diffusion methods all match reasonably
well. In this particular problem, flux-limited anisotropic diffusion is the most
accurate. The \Pone\ method fails even to produce a positive solution: this is a
known limitation of the method in multi-dimensional problems with strong spatial
and temporal gradients. Interestingly, the \APone\ solution is markedly better.
The smoothness of $\Dtens$ and $\varsigma$ as compared to $1/3\sigma$ and
$\sigma$ presumably obviate the strain on the wavelike behavior of the problem.

\begin{figure}[htb]
  \centering\small
  \subfloat[Along center]{%
    \hspace{-.25in}%
    \input{td_blastpipe/phi-center03-00/plot}}%
  \subfloat[Orthogonal view]{%
    \hspace{-.25in}%
    \input{td_blastpipe/phi-ortho03-00/plot}}%

  \caption{Scalar intensity at $t=3$ in the blast wave problem.}
  \label{fig:tdBlastwave}
\end{figure}

The time-dependent behavior of the transport solution (MC) and flux-limited
anisotropic diffusion (FLAD) is shown in Fig.~\ref{fig:tdBlastwaveAll}. At longer
times, the FLAD solution approaches the MC solution away from the uncollided
pulse of particles.

\begin{figure}[htb]
  \centering\small
    \hspace{-.15in}%
    \input{td_blastpipe/phi-all/plot}

  \caption{Comparison of Monte Carlo and flux-limited anisotropic diffusion at
  four times in the blast wave problem.}
  \label{fig:tdBlastwaveAll}
\end{figure}

The timings for the blast wave problem, as run on a single core of a 2.4 GHz
Intel Core 2 Duo chip, are presented in Table~\ref{tab:tdBlastwaveTiming}. These
give a rough idea of the relative performance of the standard diffusion methods,
the anisotropic diffusion methods, and the transport method. The initial
calculation of the anisotropic diffusion coefficients is amortized over the
subsequent time steps, so over longer times, the performance of the AD methods
asymptotically approaches the performance of the standard diffusion methods.

\begin{table}[htb]
  \centering
  \begin{tabular}{lr}
\toprule
    & Wall time (s)
\\ \midrule
MC & 790 \\
\APone & 31 \\
FLAD & 40 \\
AD & 38 \\
\Pone & 23 \\
FLD & 18 \\
Diffusion & 18
\\ \bottomrule
  \end{tabular}
  \caption{Timing comparison for the blast wave problem.}
  \label{tab:tdBlastwaveTiming}
\end{table}

\subsubsection{Extended problem parameter space}
To quantitatively verify that the positive results in this problem are not a
fluke, we parameterized the problem and extensively investigated the parameter
space.
Using Latin Hypercube Sampling \cite{Ima2008}, we sampled 40 instances of
the above problem with the following parameters and corresponding distributions:
\begin{itemize}
  \item the width of the diffusive region (uniform on $[0,2]$);
  \item the width of the channel region (uniform on $[0,1]$);
  \item the sharpness of the Gaussian (exponential with $\lambda = 100$);
  \item the value of $\sigma$ in the diffusive region (uniform on $[1,20]$); and
  \item the value of $\sigma$ in the channel region (exponential with
    $\lambda=0.1$).
\end{itemize}

As a metric of error, we compared the volume-weighted
2-norm error (with the reference solution being a Monte Carlo simulation
with $10^6$ particles) along the channel centerline and a cross-section of the
problem at $x=0.3$ at the final problem time. (Other metrics yielded similar
results.)

The error distributions are plotted in Fig.~\ref{fig:tdBlastwaveParameterized}.
Distributions more peaked toward the left of the plot are more accurate, and
wider distributions indicate a method inconsistent in its accuracy. As one might
expect from the detailed discussion of one instance of the blast wave problem,
flux-limited anisotropic diffusion is the most accurate, and \Pone\ is the least
accurate.

\begin{figure}[htb]
  \centering\small
  \subfloat[Along center]{%
    \hspace{-.25in}%
    \input{td_blastpipe/errors-phi-center-t3/plot}}%
  \subfloat[Orthogonal view]{%
    \hspace{-.25in}%
    \input{td_blastpipe/errors-phi-ortho-t3/plot}}%

  \caption{Distributions of errors in the parameterized blast wave problem.}
  \label{fig:tdBlastwaveParameterized}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusions}

We first established and tested some approximations that undergird the rest of
our results.  Namely, we ensured that non-analytic (discrete
ordinates--calculated) AD coefficients do not compromise the accuracy of the
method. The number of iterations required to converge the solution to the limit
of the exact solution's accuracy is also small enough not to make an AD
solution intractable.

With the linear numerical experiments in this chapter, we have verified the
theory developed in the previous chapters. The boundary conditions we proposed
for anisotropic diffusion in Chapter~\ref{chap:adDerivation} yield accurate
answers in our test problems where the radiation is not strongly anisotropic
throughout the problem. The boundary conditions for flatland diffusion were also
successfully tested.

Finally, we performed the first test of time-dependent anisotropic diffusion. In
a wide variety of problems with optically thin channels, the anisotropic
diffusion methods (particularly flux-limited anisotropic diffusion) outperformed
their conventional counterparts.

With these positive results for linear, time-dependent problems, we continue to
more difficult non-linear problems in Chapter~\ref{chap:trtNumericalResults}.

