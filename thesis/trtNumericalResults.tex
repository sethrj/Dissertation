% !TEX root = _individual/trtNumericalResults.tex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Numerical results: thermal radiative transfer}
\label{chap:trtNumericalResults}

Thermal radiative transfer, as we discussed at length in
Chapter~\ref{chap:trtBackground}, has additional complexities on top of the
difficulties of particle transport. The radiation source term is coupled to a
material temperature unknown, and the material's changing temperature modifies
the absorption opacity. 
The problem's physical properties are therefore time-dependent, which
imposes the extra requirement that the anisotropic diffusion coefficients be
recalculated at every time step.

We test a wide range of TRT problems, beginning with diffusive 1-D problems that
contain temperature-dependent opacities. In addition to testing multi-D problems
with optically thin channels, we compare the performance of the anisotropic
methods against conventional methods using standard 2-D TRT benchmark problems.
%We also assess the performance of the methods in a realistic problem of
%interest.

Most of the methods we compare are described at the start of
Chapter~\ref{chap:simpleNumericalResults}, but the following methods need
further discussion when applied to TRT.
\begin{description}

  \item[Monte Carlo] is replaced by Implicit Monte Carlo \cite{Fle1971}. Our
    implementation uses implicit absorption, source tilting, census combing, and
    energy-weighted path length tallies \cite{Urb2006}. Each problem uses
    roughly $10^7$ particles per time step.

  \item[Anisotropic methods] Because the opacity is a time-dependent quantity
in TRT, the anisotropic diffusion coefficients must be recalculated at every
time step. The first time step uses up to 100 source iteration sweeps%
\footnote{%
  This is a \emph{very} conservative number; as the previous chapter showed,
  two or three iterations are sufficient.
} to
calculate the coefficients, but each time step thereafter uses only one sweep to
update them. (Because the transport problem for $f$ is purely absorbing, one
sweep is sufficient to converge the diffusion coefficients in the interior.)

  \item[\Pone-like methods] A known shortcoming of \Pone\ is that, in
    multidimensional geometry with steep gradients, the radiation can have a
    negative solution. To prevent unphysical negative temperatures, we
    ``fix'' non-positive values for the radiation by setting them
    to $10^{-16}$, violating conservation by adding energy to the problem.

\end{description}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{1-D Marshak wave}\label{sec:trtOned}
We begin by testing a simple one-dimensional slab geometry problem on a refined
spatial and temporal grid. The anisotropic diffusion approximation is less
meaningful in 1-D: the rank-2 tensor becomes a scalar. Nevertheless, the AD
coefficient is still nonlocal and distinct from the standard diffusion
coefficient.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Problem description}
This ``diffusive'' test problem has been used to assess the
performance of flux limiters and nonlinear convergence schemes
\cite{Rau2005,Ols2007}. It features a smooth but
localized energy peak as an initial condition in both the material and the
radiation:
\begin{equation*}
  \phi(x,0) = [ a c T(x,0)]^{4} = 0.001 + 100 \eexp^{-100 x^2} \,.
\end{equation*}
The material is uniform with a constant heat capacity $c_v = 1$ and a
temperature-dependent
opacity $\sigma(T) = T^{-3}$. We use a uniform spatial and temporal grid of
$\Delta_x = \Delta_t = 0.01$. The boundaries at $x=0$ and $x=3$ are reflecting.

The problem uses a scaled unit system often seen in TRT methods development: $c
= a = 1$. The anisotropic diffusion coefficients are calculated with a
Gauss--Legendre $S_{16}$ quadrature set and the step characteristics method.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Results and discussion}

The Marshak wave \cite{Mar1958} is a classical feature of radiative transfer at
the boundaries between hot and cold materials. Because the cold material tends
to be optically opaque, radiation emitted from the hot material penetrates only
a short distance into the cold, rapidly heating it. As that layer of cold
material heats up, it begins to emit into the adjacent cold layer: the result
is a distinct radiation shock that looks like a wave. (Because the radiation
behavior is more diffusive than freely streaming, this wave speed does not
travel at the speed of light.)

Higher-dimensional geometries also have Marshak wave--like behavior, so the
features observed in this one-dimensional problem serves as a useful
introduction to the behavior of the different methods tested.

The wavefront position (Fig.~\ref{fig:1dblastWavefront}) provides an effective
%
\begin{figure}[htb]
  \centering\small
  \input{1d_trt_blastwave_long/wavefront/plot}
  \caption{Wavefront position of $\phi$ in 1-D blast wave problem.}
  \label{fig:1dblastWavefront}
\end{figure}
%
visualization of the problem's time evolution. The position is calculated at
each point in time by taking the radiation temperature, convolving it with a
weighted five-point kernel to smooth out potential noise in the solution, and
using linear interpolation to find the point at which the radiation temperature
is twice the initial temperature of the problem.

We note how Fig.~\ref{fig:1dblastWavefront}
shows that, during the streaming-dominated early times, both standard diffusion
and anisotropic diffusion display an unphysical wave speed. For these methods,
the slope of the wavefront position near $t=0$ exceeds $c=1$: energy is being
transferred through the system faster than the speed of light. It is this
shortcoming that motivated the development of both flux-limited diffusion
(\S\ref{sec:bgFld}) and our flux-limited anisotropic diffusion
(\S\ref{sec:flad}). Both the standard \Pone\ and anisotropic \Pone\ are wave
equations, but they have the incorrect wave speed of $c/\sqrt{3}$.

A detailed view of the radiation and material temperatures
(Fig.~\ref{fig:1dblastTemp}) at $t=3$ give further insight into the differences
%
\begin{figure}[htb]
  \centering\small
  \centering
  \subfloat[Radiation temperature]{%
    \hspace{-.25in}%
    \input{1d_trt_blastwave_long/radtemp3/plot}
  }%
  \subfloat[Material temperature]{%
    \hspace{-.25in}%
    \input{1d_trt_blastwave_long/mattemp3/plot}
  }%
  \caption{Solution at $t=3$ in the 1-D blast wave problem.}
  \label{fig:1dblastTemp}
\end{figure}
%
between the methods.
Both \Pone-like methods share a characteristic, unphysical wavefront shape
that results from the equations' hyperbolic nature.
The radiation pulse at the beginning, with its steep spatial gradients,
induces a wave-like pulse of particles that travel through the problem. The
\APone\ approximation, because it uses a non-local $\varsigma$ (see
Eq.~\eqref{eq:ap1FicksLawFinal}] rather than a local $\sigma$, is smoother: the
wavefront's ``hump''
is not as peaked, but the larger $\varsigma$ retards the propagation.

Flux-limited diffusion matches the transport solution very closely in this
problem: the gradients in the interior are small, the radiation is predominantly
isotropic, and the difficulties with streaming are overcome by the flux limiter.
However, at later times, the wavefront drops off more abruptly than the
transport solution because the limiter reduces the diffusion coefficient too
far.

Flux-limited anisotropic diffusion better matches the wavefront position and
shape of the transport solution. However, near $x=0$, the temperature is too
high: the AD coefficients are smaller than the diffusion coefficients
because of their nonlocal nature, so the radiation behind the wavefront tends to
be less homogeneous than in the standard FLD solution.

%We also note that this problem was 

Overall, in this simple problem, the flux-limited methods match the transport
solution most closely. (The problem was after all constructed to test the
relative performance of flux-limited diffusion.) The standard diffusion
and AD methods allow radiation to travel too quickly through the problem,
resulting in wavefront positions unrealistically far into the problem. The
\Pone\ methods fail to match even the qualitative shape of the solution.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Flatland pipe}
%\section{Ceci est pas une pipe}

For most transport approximations, the extension from one to multiple
dimensions is nontrivial. In the case of anisotropic diffusion, as we saw, the
diffusion coefficient becomes a diffusion tensor, necessitating new
discretization schemes. At the same time, the added complexity inherent
to anisotropic
diffusion gives it an advantage relative to standard diffusion.

The practical extension of flux-limited diffusion to multi-D is straightforward,
but the theory is less sound: most flux limiters are derived under
the assumption of 1-D radiation behavior. In multiple dimensions, the
anisotropic diffusion methods may gain additional traction relative to FLD
because their smaller diffusion coefficients reduce the necessity for flux
limiting.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Problem description}

Our first multi-D test problem for thermal radiative transfer is loosely based
on the problem of interest to the Center for Radiative Shock Hydrodynamics
(CRASH) program: radiation travels down an optically thin channel with
optically thick walls. We use the same unit system as in the 1-D test problem, $c=a=1$.

As represented in Fig.~\ref{fig:crashaltMaterials}, this flatland problem
consists of:
\begin{itemize}
  \item a radiation source region with an energy emission rate density $q_r=25$, 
    a constant opacity $\sigma=0.5$, and a constant heat capacity $c_v=0.5$;
  \item a small channel region with $\sigma = T^{-3}$ and $c_v=1.0$; and
  \item a diffusive region with $\sigma = 25 T^{-3}$ and $c_v=2.5$.
\end{itemize}
The physical properties of the channel are the same as those in the 1-D test
problem.

\begin{figure}[htb!]
  \centering
  \includegraphics{trt_crashpipealt/materials-enhanced}
  \Caption{Materials, geometry, and grid spacing in the flatland pipe problem.}{
   Each ``cell'' shown on the grid encompasses $5\times5$ cells in the actual
   numerical simulation. The red zone is the radiation source, the white zone is
 the channel, and the gray zone is the diffusive region.}
  \label{fig:crashaltMaterials}
\end{figure}

The time step is piecewise linear: it increases from $\Delta_t=0.002$ at $t=0$
to $\Delta_t=0.02$ at $t=0.1$, and stays constant thereafter. (Keeping the
time step small at the beginning is a technique used to improve the
performance of the flux limiters and reduce the linearization error during the
initial strong temperature gradients.) The mesh size used
is $\Delta_x=\Delta_y=0.02$. The initial condition is uniformly $\phi = T^4 = 0.001$, and
the problem is run until time $t=3$. All problem boundaries are reflecting.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Results and discussion}

The constant radiation source at the left end of the channel
drives the problem. At the beginning, the entire domain is optically thick
(even the channel has the initial opacity $\sigma=0.001^{-4/3}$), but it quickly
heats up as it absorbs the radiation from the source. As the material's
temperature rises, it becomes
thinner: the lower heat capacity and optical thinness of the channel cause it to
become transparent more quickly than the surrounding region. Energy flows
from the radiation source through the channel, and from the channel into the
diffusive region.

Two lineouts of the material temperatures at the final state are plotted in
Fig.~\ref{fig:crashaltMattemp}.
%
\begin{figure}[htb]
  \centering\small
  \subfloat[Centerline view]{%
    \label{fig:crashaltMattempCenter}%
    \hspace{-.25in}%
    \input{trt_crashpipealt/mattemp-center3/plot}
  }%
  \subfloat[Orthogonal view]{%
    \label{fig:crashaltMattempOrtho}%
    \hspace{-.25in}%
    \input{trt_crashpipealt/mattemp-ortho3/plot}
  }%
  \caption{Material temperature at $t=3$ in the flatland source problem.}
  \label{fig:crashaltMattemp}
\end{figure}
%
The standard diffusion approximation performs
poorly: like in the 1-D problem, it allows energy to move too quickly. Yet
unlike in the 1-D problem, standard flux-limited diffusion also
performs poorly. As seen by comparing the centerline
(Fig.~\ref{fig:crashaltMattempCenter}) and orthogonal
(Fig.~\ref{fig:crashaltMattempOrtho}) views, flux-limited diffusion artificially
constrains the movement of energy into the surrounding opaque materials,
preferring instead to heat the channel and further propagate energy in that
direction. This is not entirely unexpected: flux limiters cannot approximate the
full angular dependence of the intensity; they only restrict the flow of energy
\emph{based on the local spatial gradients}. The gradients at the cold--hot
material interface in the diffusive material are strong, so the flow of
radiation is limited.

Compared to the conventional methods, the new anisotropic methods perform quite
well. The similarity between the AD and FLAD answers suggest that, as
anticipated, the flux limiter used less in the case of anisotropic diffusion.

The behavior of the anisotropic methods relative to conventional
diffusion can be better understood by viewing the magnitude of the
diffusion coefficients and anisotropic diffusion tensor.
Figure~\ref{fig:crashaltDcoeff} shows the diffusion coefficients
%
\begin{figure}[htb]
  \centering\small
  \subfloat[Centerline view]{%
    \hspace{-.25in}%
    \input{trt_crashpipealt/dcoeff-center-t3/plot}
  }%
  \subfloat[Orthogonal view]{%
    \hspace{-.25in}%
    \input{trt_crashpipealt/dcoeff-ortho-t3/plot}
  }%
  \Caption{Diffusion coefficients at $t=3$ in the flatland pipe problem.}{
    The three components of the FLAD tensor are plotted as solid lines; the
    flux-limited diffusion and standard diffusion coefficients are plotted for
    comparison.}
  \label{fig:crashaltDcoeff}
\end{figure}
%
of FLAD, FLD, and standard diffusion at the final state. (The components of the
FLAD tensor are plotted separately.)
The anisotropic diffusion tensor
remains consistently smaller than the diffusion coefficients, slowing down the
radiative transfer even compared to flux-limited diffusion. We also note that in
most of the problem, the off-diagonal component of the AD tensor $D^{xy}$ is
much smaller than the corresponding $D^{xx}$ and $D^{yy}$ components: the
temperature-dependent opacity in the problem is nearly symmetric about the line
$y=1$, so this is not unexpected.

The anisotropy of the problem is plotted in Fig.~\ref{fig:crashaltAnisotropy}.
This metric is defined by:
\begin{equation}\label{eq:anisotropyMetric}
  \text{anisotropy} = \frac{\abs{\lambda_1 - \lambda_2} }{ \sqrt{
  \lambda_1^2 + \lambda_2^2} }\,,
\end{equation}
where $\lambda$ are the eigenvalues of the diffusion tensor $\Dtens$.
%
\begin{figure}[htb]
  \centering
  \includegraphics[width=3in]{trt_crashpipealt/anisotropy}
  \Caption{Anisotropy of the flatland pipe problem.}{
    In white regions, the FLAD tensor is isotropic, and in red regions, it is
  highly anisotropic.}
  \label{fig:crashaltAnisotropy}
\end{figure}
%
An isotropic diffusion tensor is proportional to the identity matrix, so its
eigenvalues are equal, giving an anisotropy of zero. A tensor that only allows
diffusion along one axis (i.e., $\lambda_2 = 0$) would have an anisotropy of
unity. In this problem, the AD method produces strongly anisotropic coefficients
in the channel.
%abs(eigenvalues[0] - eigenvalues[1])/ sqrt( * (eigenvalues[0]^2 +eigenvalues[1]^2) )

Because the problem is driven by a constant spatial source rather than a pulsed
initial condition, the gradients are smoother than in the 1-D Marshak wave
problem, and the \Pone\ and \APone\ methods concordantly perform much better.
In fact, the
\APone\ and FLAD methods are qualitatively very close, as are the \Pone\ and FLD
methods.

Finally, a plot of the wavefront location along the channel centerline
(Fig.~\ref{fig:crashaltWavefront}) provides a comparison of the methods over a
broader range of times.
%
\begin{figure}[htb]
  \centering\small
  \input{trt_crashpipealt/wavefront-center/plot}
  \caption{Wavefront position of $\phi$ in the flatland pipe problem.}
  \label{fig:crashaltWavefront}
\end{figure}
%
Both the diffusion and AD methods initially push energy too quickly into the
channel, but the more moderate AD coefficients naturally limit the speed after
that point. Only during the initial $\sim0.5$ units of time are the slopes of the
FLAD- and AD-calculated wavefront positions different, demonstrating that
flux limiting is most important at the initial times and less so thereafter.

We more quantitatively test our expectation (\S\ref{sec:flad}) that the more
moderate AD coefficients require less limiting than standard diffusion.
Using this flatland pipe problem, we compare anisotropic diffusion to
standard diffusion, with a ``max'' limiter modifying the coefficients of both.
(The rest of our FLD problems use the ``square root'' limiter.)
When the magnitude of the cell-average flux $\norm{\vec{F}}$ exceeds the cell-average
$\phi$, the limiter not only modifies the diffusion coefficient/tensor but also
increments a counter. In Fig.~\ref{fig:crashaltFld}, we plot the fraction of
cells that required limiting in each time step as a function of time. 
%
\begin{figure}[htb]
  \centering\small
  \input{trt_crashpipealt/fld/plot}
  \caption{Application of flux limiters for anisotropic and standard diffusion
  in the flatland pipe problem.}
  \label{fig:crashaltFld}
\end{figure}
%
As a reminder, the relatively thin channel comprises 10\% of the problem, and
the problem contains $10\,000$ cells total. Both methods require the same
amount of limiting during the initial transient, but flux limiting is active in
far fewer cells at later times. Because flux limiting is an \emph{ad hoc}
fix-up, it is desirable for a method to do without it.

We note that this problem was also solved with the AD coefficients calculated on
a coarse grid, as discussed in \S\ref{sec:coarseGridAdCoeff}. Even though the
wall time for the calculation was significantly decreased, errors on the order
of 10\% or more were introduced in the solution. In the steady-state calculation
of AD coefficients, material boundaries are well-defined, so a coarse grid may
be easily chosen that shares those boundaries. With nonlinear opacities, the
boundary between high- and low-opacity materials changes at every time step,
preventing the na\"ive imposition of a coarse grid.

This test problem has demonstrated the feasibility of the anisotropic diffusion
approximations to outperform conventional methods in multi-dimensional
TRT problems. The strongly anisotropic diffusion tensor approximates the flow of
radiation through the channel better than the conventional isotropic diffusion
coefficient.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\section{Crooked pipe}

To add additional complexity, we modified the flatland pipe problem by adding
two bends in it and adjusting the physical coefficients to more closely resemble
the ``crooked pipe'' problem from Ref.~\cite{Gen2001}.

\subsection{Problem description}

This ``crooked pipe'' or ``dogleg'' problem (Fig.~\ref{fig:doglegMaterials})
%
\begin{figure}[htb]
  \centering
  \includegraphics{trt_dogleg/materials-enhanced}
  \Caption{The crooked pipe problem configuration.}{
  The streaming region is white, and the diffusive region is gray. The arrows
  indicate an isotropic incident radiation boundary. The centerlines of the
  three legs are shown with a dotted line; the four fiducial points are circled.}
  \label{fig:doglegMaterials}
\end{figure}
%
uses flatland geometry rather than the $r$-$z$ geometry typically seen in
pipe/obstacle problems. It also uses the model system $a=c=1$ rather than
physical coefficients. The problem consists of an optically thin
streaming region embedded in an optically thick diffusive region. The thin
``pipe'' has a very small heat capacity and opacity: $c_v=0.01$ and
$\sigma=0.25T^{-3}$. The diffusive region has $c_v=5$ and $\sigma=200 T^{-3}$.
The pipe has a width of 0.2 (although, because of the reflecting boundary at
the top of the problem, it represents a channel with width 0.4 at that point);
the legs are 1.0, 0.8, and 1.0 units long.

As with the previous scaled problem, the material and radiation temperatures
have a uniform initial condition of $\phi = T^4 = 0.001$, and $a=c=1$. The
problem is driven by an isotropic boundary source on the left edge of the pipe
with an incident radiation temperature $T_\text{rad} = 5^{1/4}$. (This gives
an incident radiation flux of $5/\pi$; see Eq.~\eqref{eq:bndyTradFlatland}.)
The top boundary is reflecting, and all other boundaries are vacuum.

The problem runs until $t=10$, with varying time steps
(Fig.~\ref{fig:doglegTimestep}) that range from $\Delta_t=0.0125$ to
$\Delta_t=0.1$ to account for the stronger temporal gradients
at the beginning of the problem. (Small time steps are needed
to prevent IMC, and other methods to a lesser extent, from violating the maximum
principle.\footnote{%
See Ref.~\cite{Lar1987} for a discussion of the maximum principle.
})
The chosen grid width is $\Delta_x = 0.025$ for IMC and $\Delta_x = 0.0125$
for the deterministic methods. (In this problem, the spatial discretization
error for the diffusion methods was much higher than the other problems
we ran because of the very optically thick region, so we refined the mesh for
those methods.)

\begin{figure}[htb]
  \centering
  \input{trt_dogleg/timestep/plot}
  \caption{Time steps used in the crooked pipe problem.}
  \label{fig:doglegTimestep}
\end{figure}

The analysis will primarily consider segments along the centerline of the legs
(dashed lines
in Fig.~\ref{fig:doglegMaterials}) and certain fiducial points in the channel
that are representative of the radiation behavior over time. These points,
circled in Fig.~\ref{fig:easymkMaterials}, have the $(x,y)$ coordinates: $(0.1,
1.0)$, $(0.9, 1.0)$, $(0.9, 0.3)$, and $(1.7, 0.3)$.

\subsection{Results and discussion}

With the semi-implicit linearization, the problem is highly scattering and
thus expensive for MC solvers. In fact, our particular choice of $\sigma
\propto T^{-3}$ and $c_v \propto 1$ means that the denominator of the Fleck
factor, $\beta \sigma$ [see Eq.~\eqref{eq:beta}], is
temperature-independent inside each material, and we can calculate \emph{a
priori} the effective scattering ratio $\sigma_\text{es}/\sigma$:
\begin{align*}
  \text{effective scattering} = 1 - f
  &= 1 - \left[ 1 + \beta c \Delta_t \sigma \right]\inv
  \\
  &= 1 -  \left[ 1 +\left(  \frac{4 a T^3}{ c_v } \right) c \Delta_t (\alpha T^{-3}) \right]\inv
  \\
  &= 1 - \left[ 1 + 4 \Delta_t \frac{\alpha}{c_v} \right]\inv\,,
\end{align*}
where $\frac{\alpha}{c_v} = 25$ in the channel and $\frac{\alpha}{c_v} = 40$ in
the medium. In the final time step with $\Delta_t=0.1$, the Fleck factor is
about $0.09$ in the channel and $0.06$ in in the
diffusive medium: the effective scattering ratio is above $0.9$ throughout the
problem.

Figure~\ref{fig:doglegRadtempFinal} plots the radiation temperature at the final
%
\begin{figure}[htb]
  \centering
  \includegraphics[width=3in]{trt_dogleg/radtemp-t10}
  \Caption{Radiation temperature at $t=10$ in the crooked pipe problem.}{
  From top to bottom, the methods compared are IMC, FLAD, and FLD.}
  \label{fig:doglegRadtempFinal}
\end{figure}
%
state $t=10$ for the reference solution (IMC), the flux-limited diffusion
solution (FLD), and the flux-limited anisotropic solution (FLAD). Clearly, the
complicated features in this problem lead to very different approximate
answers, unlike the self-similar results seen in in the simple 1-D case of
\S\ref{sec:trtOned}.

This problem has the same qualitative behavior as the previous flatland pipe
problem: radiation streams through the optically thin pipe, heating it and
the surrounding diffusive material. One notable difference is that the smaller
heat capacity more tightly
couples the radiation and material temperatures: the incident radiation heats
the material in the channel more quickly.

The choice of a boundary source rather than an interior source further
differentiates the anisotropic diffusion methods from the conventional diffusion
methods (see Fig.~\ref{fig:doglegRadtemp1}). Because the conventional and
%
\begin{figure}[htb]
  \centering\small
  \subfloat[Leg 1 at $t=0.5$]{%
    \hspace{-.25in}%
    \input{trt_dogleg/radtemp-leg1-t050/plot}
    \label{fig:doglegRadtemp1}
  }%
  \subfloat[Leg 2 at $t=3.0$]{%
    \hspace{-.25in}%
    \input{trt_dogleg/radtemp-leg2-t300/plot}
    \label{fig:doglegRadtemp2}
  }%
  \caption{Representative plots of the radiation temperature in the crooked
  pipe problem.}
  \label{fig:doglegRadtemp}
\end{figure}
%
anisotropic diffusion methods yield such different diffusion coefficients
(Fig.~\ref{fig:doglegDcoeff}), the slope of the radiation temperature at the
%
\begin{figure}[htb]
  \centering\small
  \subfloat[Leg 1]{%
    \hspace{-.25in}%
    \input{trt_dogleg/dcoeff-leg1/plot}
  }%
  \subfloat[Leg 2]{%
    \hspace{-.25in}%
    \input{trt_dogleg/dcoeff-leg2/plot}
  }%
  \Caption{Diffusion coefficients at $t=10$ in the crooked pipe problem.}{
    The three components of the FLAD tensor are plotted as solid lines; the
    flux-limited diffusion and standard diffusion coefficients are plotted for
    comparison.}
  \label{fig:doglegDcoeff}
\end{figure}
%
boundary is very different. The flatter slope of the standard
diffusion methods (due to the very large $D$) strongly affects the rate at which
radiation penetrates the problem: even with a flux limiter, diffusion
overestimates the amount of radiation that moves through the channel.

An additional complication is the strongly multi-dimensional layout of this
problem. The true transport solution (IMC) shows highly collimated radiation
streaming through the channel, impacting the obstacle at $x=1$, and heating it
so that it re-emits isotropically. The limited approximations of standard
diffusion do not take this into
account at all: radiation flows isotropically through the bends with nary a care
for the obstacle. Flux-limited anisotropic diffusion captures some of the
strong anisotropy of the intensity, thereby driving energy into the obstacle and
heating it up. The smaller magnitude of the AD coefficients in the channel
cause the surrounding
diffusive regions to heat up more than with FLD. However, only the transport
method (IMC) is able to capture the full multi-dimensional aspects of the
solution. In Fig.~\ref{fig:doglegRadtemp2}, for example, there is a sudden
drop-off in the IMC solution at $y=0.8$ along the centerline of leg 2: this is
at the bottom edge of the first leg, where the relatively opaque diffusive
region obstructs radiation emitted by the boundary source. Only transport can
truly
model that the primary source of particles into the second leg is by radiative
emission from the heated wall. (The channel has a very small $\sigma$, meaning
its emission term $\sigma a c T^4$ is also small.) Diffusion and anisotropic
diffusion only approximate this effect by allowing particles to diffuse around
corners.

To better compare the time-dependent behavior of the methods, we turn to
the radiation temperature as a function of time at the first and second fiducial
points (Fig.~\ref{fig:doglegFiducial}). As we have already discussed, the
diffusion and
%
\begin{figure}[htb]
  \centering\small
  \subfloat[$x=0.9$, $y=1.0$]{%
    \hspace{-.25in}%
    \input{trt_dogleg/fiducial-radtemp-leg2/plot}
  }%
  \subfloat[$x=0.9$, $y=0.3$]{%
    \hspace{-.25in}%
    \input{trt_dogleg/fiducial-radtemp-leg3/plot}
  }%
  \Caption{Fiducial points at the end of the first (a) and second (b) legs.}{
    These plots show the time-dependent behavior of all the methods tested.}
  \label{fig:doglegFiducial}
\end{figure}
%
AD solutions allow radiation to travel unphysically fast: the radiation
temperature for these methods rises sooner than the other methods. The rate of
the temperature rise in all three anisotropic methods is much closer to that of
the transport solution. Even though anisotropic diffusion allows too much
radiation into the second leg, it provides a much closer approximation to the
transport solution.

In Fig.~\ref{fig:doglegFiducialAll} we have overlaid the reference solution
%
\begin{figure}[htb]
  \centering\small
  \hspace{-.25in}%
  \input{trt_dogleg/fiducial-radtemp-all/plot}
  \Caption{Plot of the radiation temperature at the four fiducial points.}{
  IMC (blue and black dashed lines), FLD (green and magenta dotted lines), and
  FLAD (red and cyan solid lines) are compared. The $y$ scale ranges from 0.16
  to 1.6.}
  \label{fig:doglegFiducialAll}
\end{figure}
%
(IMC), flux-limited diffusion, and flux-limited anisotropic diffusion at all
four representative points. The leading tail in FLD and FLAD is an artifact of
the temporal discretization error. The IMC and FLAD show good agreement at the
first two points for nearly all times, but after the first bend in the problem,
the accuracy of FLAD suffers. The FLD approximation allows energy to travel
through the problem far too rapidly: its calculated solution in the pipe is
nearly constant by $t=2$, whereas the transport solution does not show radiation
heating the final point until $t=5$.

In Table~\ref{tab:doglegTiming} we compare the amount of computer time taken
for each of the problems.
%
\begin{table}[htb]
  \centering
  \begin{tabular}{lr}
\toprule
    & Wall time (s)
\\ \midrule
IMC & 54300 \\
\APone & 94 \\
FLAD & 48 \\
AD & 44 \\
\Pone & 73 \\
FLD & 43 \\
Diffusion & 44
\\ \bottomrule
  \end{tabular}
  \caption{Timing comparison for the crooked pipe problem.}
  \label{tab:doglegTiming}
\end{table}
%
The one transport sweep per time step needed to calculate $\Dtens$
accounts for about half of the run time for the anisotropic methods, but
the total wall time for each AD method is approximately equal to that of the
conventional diffusion methods.
Our explanation is related to how the magnitude of the diffusion coefficients
affects the conditioning of the diffusion matrix. The anisotropic diffusion
coefficients are a factor of ten smaller than those of flux-limited diffusion
(see Fig.~\ref{fig:doglegDcoeff}). By explicitly saving the sparse diffusion
matrices to files and importing them into MATLAB, we determined that the
approximate 1-norm condition numbers for the FLD and FLAD matrices (at the
final state $t=10$) are $1.6\EE4$ and $1.2\EE3$, respectively.
The CG solver converges more
quickly for better-conditioned matrices, so the low-order AD solution
is faster than the FLD solution. The additional expense of the
calculation of the anisotropic diffusion coefficients by chance brings the
wall time of the AD methods to parity with the conventional diffusion
methods. (We suspect that a well-chosen preconditioner for each method will
equalize the computational effort spent in the diffusion solve, so the AD
methods will require slightly more time overall.)


In this test problem, the anisotropic diffusion methods consistently produce
more accurate solutions than the standard diffusion methods without
an increase in computing time. The flux limiter
(FLAD) further improves the result by reducing the speed of the initial
radiation wave. As seen in the previous flatland pipe problem, the \APone\
approximation yields solutions similar to those of FLAD. None of the approximate
methods can exactly reproduce the transport solution, but by all metrics the new
anisotropic diffusion methods approximate the transport solution far better
than conventional diffusion methods.

%None of the anisotropic
%methods exactly reproduces the transport solution.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage
\section{2-D \texorpdfstring{``easy''}{easy} obstacle problem}

One might argue that the previous flatland problems are particularly suited to
the
anisotropic approximations because of the clear-cut ``channel'' voided
configuration. How then do the methods perform on problems
\emph{without} simple, optically thin channels in a thicker medium? To answer this
question, we have tested the methods against existing multi-D test problems in
the literature.

\subsection{Problem description}

The ``easy'' obstacle problem (Fig.~\ref{fig:easymkMaterials}),
%
\begin{figure}[htb]
  \centering
  \includegraphics{trt_easymk/materials-enhanced}
  \Caption{Problem layout for the ``easy'' obstacle problem.}{
    The gray blocks are 50\% more opaque than the white region at the same
  temperature.}
  \label{fig:easymkMaterials}
\end{figure}
%
described in Ref.~\cite{Mou2006} (and also used in
Ref.~\cite{Kno2007}), contains two square obstacles that impede a front of
radiation emitted by a boundary source. It is a
two-dimensional problem on the domain $0 \le x \le 2$, $0 \le y \le 1$ with
$\Delta_x=\Delta_y=1/32$. The
problem has a uniform heat capacity $c_v = 1$, and the opacity is
$\sigma=T^{-3}$ everywhere except inside two obstacles, where $\sigma= 1.5
T^{-3}$. These obstacles are squares of width $5/8$, with lower-left corners
at $(3/16, 3/16)$ and $(19/16, 3/16)$. It uses the model unit system $c=a=1$.

The top and bottom boundaries are reflecting; the left of the problem has an
incident black body radiation source with $T_\text{rad} = 5^{1/4}$, and the right
side of the problem has a vacuum boundary. (The black body boundary condition
has an incident radiation flux of $5/4$; see Eq.~\eqref{eq:bndyTrad3D}.) The
initial condition is $\phi = T^{4} = 0.001$.

In Ref.~\cite{Mou2006}, the problem halts at $t=3$; for the sake of completeness we
compare the convergence of the solutions until $t=8$ in
Fig.~\ref{fig:easymkConvergence}. We use a uniform time step $\Delta_t=0.01$.

We use a ``level-symmetric'' Chebyshev--Legendre S$_{16}$ quadrature set for
calculating the AD coefficients. (This quadrature set uses a Gauss--Legendre
quadrature to obtain polar angles, and Chebyshev--Gauss quadratures for the
azimuthal directions, with fewer azimuthal ordinates with increasing polar
level.)

\subsection{Results and discussion}

The radiation source on the left 

Qualitatively, flux-limited diffusion and flux-limited anisotropic diffusion
perform equally well (Fig.~\ref{fig:easymkContour}).
%
\begin{figure}[htb]
  \centering
  \subfloat[Radiation temperature at $t=3$]{%
    \includegraphics{trt_easymk/radtemp_contour_t3}
  }%
  \subfloat[Radiation temperature at $t=3$]{%
    \includegraphics{trt_easymk/radtemp_contour_t6}
  }
  \Caption{Contour plot of the solution at $t=3$ and $t=6$ in the easy obstacle
  problem.}{
  The black dashed line is the IMC solution, the blue solid line is the
  FLAD solution, and the red dotted line is the FLD solution. Contours are at
  $0.25, 0.5, \dots, 1.25$.}
  \label{fig:easymkContour}
\end{figure}
%
Whereas FLD contains spatial gradients that are slightly
too steep, FLAD is unnaturally smooth due to its smoother anisotropic diffusion
coefficients.

A more detailed comparison of the methods at the intermediate time $t=3$
(Fig.~\ref{fig:easymkCenterline}) shows that the IMC reference solution agrees
%
\begin{figure}[htb]
  \centering
  \subfloat[Radiation temperature]{%
    \hspace{-.25in}%
    \input{trt_easymk/radtemp-center3-00/plot}
  }%
  \subfloat[Material temperature]{%
    \hspace{-.25in}%
    \input{trt_easymk/mattemp-center3-00/plot}
  }%
  \caption{Solution along the centerline at $t=3$ in the easy obstacle
  problem.}
  \label{fig:easymkCenterline}
\end{figure}
%
with the conventional FLD more closely inside the obstacle, but FLAD gives a
better result in the channel.

To provide a quantitative comparison of the
methods, we have compared the difference in the temperature (volume-weighted
relative 2-norm) between each method and the reference solution as a function of
time (Fig.~\ref{fig:easymkConvergence}).
%
\begin{figure}[htb]
  \centering
  \input{trt_easymk/convergence-mattemp/plot}
  \caption{Relative difference of the material temperature in the easy obstacle
  problem, compared against IMC.}
  \label{fig:easymkConvergence}
\end{figure}
%
This metric,
\begin{equation*}
  \text{reported difference} =
  \left[ \sum_{i \in \text{cells}} \left(
  \frac{T_i}{T_{i,\text{reference}}} - 1 \right)^2 (V_i)^2\right]^{1/2} \,,
\end{equation*}
is similar to Eq.~\eqref{eq:rel2norm} used in the previous chapter.
From the plotted relative differences, it appears that the most accurate method
overall is flux-limited anisotropic diffusion. Diffusion is the least accurate,
and the \APone\ and \Pone\ methods perform similarly.

In this problem, our new anisotropic methods do not notably outperform the
conventional diffusion-based methods. Anisotropic diffusion can be an
improvement over standard diffusion in some but not all problems.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{2-D \texorpdfstring{``hard''}{hard} obstacle problem}

A second problem from Ref.~\cite{Mou2006} has steeper spatial gradients and
large voided regions: it should therefore be outside the comfort zone of
both conventional and anisotropic diffusion methods.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Problem description}

The ``hard'' obstacle problem has the 2-D domain $0 \le x,y \le 1$ and uses a
cell width $\Delta_x=\Delta_y=1/64$. The heat capacity is uniform, $c_v=1$, and
the opacity is $\sigma=T^{-3}$ outside of two square obstacles, which have
$\sigma=10 T^{-3}$. The square obstacles, each of which has a width of $1/4$, are
stationed with lower-left corners at $(3/16, 9/16)$ and $(9/16,3/16)$.

\begin{figure}[htb]
  \centering
  \includegraphics{trt_hardmk/materials-enhanced}
  \Caption{Problem layout for the ``hard'' obstacle problem.}{
    The gray blocks are ten times as opaque than the white region at the same
  temperature.}
  \label{fig:hardmkMaterials}
\end{figure}

All energy in the problem comes from the Gaussian initial condition:
\begin{equation*}
  \phi(x,y,0) = [ a c T(x,y,0)]^{4} = 0.001 + 100 \eexp^{-100 (x^2 + y^2) } \,.
\end{equation*}
In the model's unit system, $a=c=1$.

The problem is run until $t=3$. The time step increases linearly from
$\Delta_t=0.0001$ at
$t=0$ to $\Delta_t=0.01$ at $t=1$ and is constant thereafter. To calculate the
anisotropic diffusion coefficients, we use the same Chebyshev--Legendre level
symmetric quadrature set as in the easy obstacle problem.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Results and discussion}

The large optically thick region and the sharp discontinuity in temperature at
the obstacles pose a challenge to all of the approximate methods. As we saw in
the linear test problem of \S\ref{sec:tdBlastwave}, only a transport method is
able to accurately capture the hyperbolic nature of the transport equation. In
Fig.~\ref{fig:hardmkPseudocolor} we have plotted the radiation field at a time
in the problem where the transport effects are particularly visible.
%
\begin{figure}[htb]
  \centering
  \hspace{-1in}%
  \includegraphics[width=5in]{trt_hardmk/radtemp_t25}
  \Caption{Pseudocolor plots of the radiation temperature at $t=2.5$.}{
  The methods compared are: IMC (upper left), FLAD (upper right), FLD (lower
  left), AP1 (lower right). The temperature scale is linear and ranges from
  $0.18$ (white) to $1$ (black).}
  \label{fig:hardmkPseudocolor}
\end{figure}
%
The optically thick obstacles have impeded the flow of radiation, heating up
slowly at their exterior, re-radiating from their outer boundary into the
medium, but preventing radiation from passing through. The radiation streams
through the gap in the middle, at first almost as a mono-directional beam. As it
heats up the upper right section of the problem, isotropic black-body emission
warms the reverse sides of the blocks.

The diffusion methods cannot reproduce the hyperbolic behavior of radiation
streaming through avoid. In the conventional diffusion methods, radiation
diffuses isotropically through the problem: it flows unnaturally around the
obstacles. In Fig.~\ref{fig:hardmkPseudocolor}, this is seen in the FLD solution
(lower left): the more homogeneous radiation field has fully surrounded the
obstacle.

Fig.~\ref{fig:hardmkDiag} gives a more detailed look at the final state.
%
\begin{figure}[htb]
  \centering
  \subfloat[Radiation temperature]{%
    \hspace{-.25in}%
    \input{trt_hardmk/radtemp-diag3-00/plot}
  }%
  \subfloat[Material temperature]{%
    \hspace{-.25in}%
    \input{trt_hardmk/mattemp-diag3-00/plot}
  }%
  \caption{Solution along the diagonal at $t=3$ in the hard obstacle problem.}
  \label{fig:hardmkDiag}
\end{figure}
%
With the exception of \Pone, the approximate methods qualitatively
capture the behavior of the radiation and material temperatures along the
diagonal of the problem. The initial gradient proved too strong for \Pone, which
showed unphysical wavelike behavior throughout the problem. The smoother
coefficients in the \APone\ equation moderate the wavelike behavior, allowing it
to represent the behavior of the radiation more accurately.

This problem demonstrates again that anisotropic diffusion is not a ``silver
bullet.'' It is unable to model the hyperbolic behavior of the transport equation,
but at the same time it performs no less poorly than conventional flux-limited
diffusion.

%\begin{figure}[htb]
%  \centering
%  \input{trt_hardmk/wavefront-diag/plot}
%  \caption{Wavefront plot along the diagonal in the hard obstacle problem.}
%  \label{fig:hardmkWavefront}
%\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{comment}
%\clearpage
\section{CRASH-like problem}

THIS ISN'T WORKING: I CANNOT EXPLAIN IT. Perhaps, given the quantity and quality
of the other test problems, we should omit this one? I'm meeting with Eric Myra
on 11/21 to discuss my problem and why even the 1-D versions I've created do not
even qualitatively match their numerical results.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Problem description}

The physical opacities in Fig.~\ref{fig:seriousOpacity} are interpolated from a
table of Rosseland-averaged opacities given as $\sigma(\log \rho, \log T)$, 
%
\begin{figure}[htb]
  \centering\small
  \hspace{-.5in}%
  \input{trt_serious/physical-opacity/plot}
  \Caption{True opacities and modeled versions used in the CRASH-like
  problem.}{
  The true opacities (solid line) are generated from physical data,
  and the model opacities (dashed lines of the same color and marker) are
  fitted.}
  \label{fig:seriousOpacity}
\end{figure}
%
and a crude temperature model approximates the more realistic model:
\begin{equation*}
  \sigma(T;\gamma,T_1,T_2) =
  \begin{cases}
    \gamma   & T < T_1\,, \\
    \gamma \left( \frac{T}{T_1} \right)^{-3}   & T_1 \le T < T_2\,, \\
    \gamma \left( \frac{T_2}{T_1} \right)^{-3}
    \left( \frac{T}{T_2} \right)^{-1/2}   & T_2 \le T \,.
  \end{cases}
\end{equation*}

The values for $\gamma$, $T_1$, and $T_2$, along with other physical properties
of the materials, are given in Table~\ref{tab:seriousPhysics}. The unit system
uses electron volts (eV) as a unit of energy, and eV$_T$ as a unit of temperature, where
$1\units{K} = 8.6173324\EE{-5} \units{eV$_T$}$. The unit of length is centimeters
(cm), and time is in nanoseconds (ns). With these scalings, $c=29.9792458
\units{cm/ns}$, and $a=8.5634228\EE{13} \units{eV/cm$^3$-eV$_T^4$}$.

\begin{table}[htb]
  \centering
  \begin{tabular}{llllll}
\toprule
Material & Width [cm] & $c_v$ [eV/eV$_T$-cm$^{-3}$] & $\gamma$ [cm$^{-1}$]
& $T_1$ [eV$_T$] & $T_2$ [eV$_T$]
\\ \midrule
Plastic (original) & 0.0025 & $1.89\EE{23}$ & $14500$ & $80$ & $2.3\EE3$\\
Plastic (stretched) & 0.01 & $4.73\EE{22}$ & $3620$ & $80$ & $2.3\EE3$\\
Be & 0.1 & $1.05\EE{21}$ & $634$ & $6$ & $250$\\
Xe (post-shock) & 0.08 & $2.06\EE{20}$ & $138$ & $150$ & $4.7\EE3$\\
Xe (shock) & 0.02 & $1.14\EE{21}$ & $729$ & $150$ & $4.5\EE3$\\
Xe (pre-shock) & 0.20 & $6.74\EE{19}$ & $45.4$ & $150$ & $5\EE3$
\\ \bottomrule
  \end{tabular}
  \Caption{Physical parameters used in the CRASH-like simulation problem.}{
  The ``stretched'' version of the plastic is used in our simulation; it
  replaces the original physical plastic.}
  \label{tab:seriousPhysics}
\end{table}

\begin{figure}[htb]
  \centering
  \includegraphics[width=6in]{trt_serious/materials}
  \Caption{Materials, geometry, and grid spacing in the CRASH-like problem.}{
   Each ``cell'' shown on the grid encompasses $5\times5$ cells in the true
   numerical simulation. The red zone is plastic, yellow is Be, blue is
   post-shock Xe, cyan is shock Xe, and green is pre-shock Xe.}
  \label{fig:seriousMaterials}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Results}

The profile of energy deposition in the wall is an important diagnostic in the
radiation hydrodynamics problem relevant to the CRASH program \cite{HolCom2011}.

\begin{figure}[htb]
  \centering
  \includegraphics[width=6in]{trt_serious/adcoeff}
  \Caption{Opacity and AD tensors of the CRASH problem near the shock at $t=0.2$.}{
   The opacity is plotted on a log scale in shades of gray (white is optically
   thin). The AD coefficients range from very small (red) in the optically
   thick regions to very large (violet).}
  \label{fig:seriousAdcoeff}
\end{figure}

\begin{figure}[htb]
  \centering\small
  \subfloat[Radiation temperature]{%
    \includegraphics[width=6in]{trt_serious/radtemp02}
  }

  \subfloat[Material temperature]{%
    \includegraphics[width=6in]{trt_serious/mattemp02}
  }

  \Caption{Solution at $t=0.2\units{ns}$ in the CRASH-like problem.}{
  From top to bottom, the solutions for AD, FLD, and FLAD are plotted.}
  \label{fig:seriousTemp}
\end{figure}

\begin{figure}[htb]
  \centering
  \subfloat[Radiation temperature]{%
    \hspace{-.25in}%
    \input{trt_serious/radtemp-center0-20/plot}
  }

  \subfloat[Material temperature]{%
    \hspace{-.25in}%
    \input{trt_serious/mattemp-center0-20/plot}
  }
  \caption{Solution along the centerline ($y=0$) at $t=0.2\units{ns}$ in the
  CRASH-like problem.}
  \label{fig:seriousTempCenterline}
\end{figure}

\begin{figure}[htb]
  \centering
  \hspace{-.25in}%
  \input{trt_serious/absorption-plastedge0-20/plot}
  \caption{Absorption along the inside edge of the plastic centerline
    ($y=0.028750$) at $t=0.2\units{ns}$ in the CRASH-like problem.}
  \label{fig:seriousAbsorption}
\end{figure}


\begin{figure}[htb]
  \centering
  \includegraphics[width=6in]{trt_serious/anisotropy}
  \Caption{Anisotropy of the CRASH-like problem.}{
    In white regions, the FLAD tensor is isotropic, and in red and black
  regions, it is highly anisotropic. The scale is the same as in
  Fig.~\ref{fig:crashaltAnisotropy}.}
  \label{fig:seriousAnisotropy}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Discussion}

\end{comment}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusions}

The wide variety of problems we chose to test in this section give a full
picture of the behavior of the anisotropic diffusion methods in TRT problems.
Although the new approximations do not perform much better than conventional
diffusion approximations in 1-D geometry or problems with large voids, FLAD and
\APone\ provide qualitatively good answers for problems where radiation travels
through small voided regions.

In small regions of optically thin materials, the AD method calculates strongly
anisotropic coefficients in those regions that provide better
answers than conventional diffusion. Using a flux limiter with the AD
approximation (FLAD) fixes the unphysical violation of the speed of light
seen in early time steps.

We conclude that in many realistic, multi-dimension problems of interest,
flux-limited anisotropic diffusion is a better solution method than
conventional flux-limited diffusion. The small amount of computational effort
needed to calculate the AD coefficients is repaid by superior results.
